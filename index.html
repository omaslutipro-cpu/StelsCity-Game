<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StelsCity v1.0.0</title>
    <style>
        /* ========== RESET ========== */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            background: #0f172a;
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            height: 100vh;
            overflow: hidden;
        }
        
        /* ========== LOADING SCREEN ========== */
        #loadingScreen {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: #0f172a;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }
        
        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(59, 130, 246, 0.3);
            border-top: 5px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        /* ========== AUTH SCREENS ========== */
        .auth-screen {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: #0f172a;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9000;
            padding: 20px;
        }
        
        .auth-card {
            background: #1e293b;
            border: 2px solid #3b82f6;
            border-radius: 15px;
            padding: 30px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
        }
        
        .auth-title {
            text-align: center;
            font-size: 2rem;
            margin-bottom: 25px;
            color: #60a5fa;
        }
        
        .auth-tabs {
            display: flex;
            margin-bottom: 25px;
            background: #334155;
            border-radius: 10px;
            padding: 5px;
        }
        
        .auth-tab {
            flex: 1;
            text-align: center;
            padding: 12px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s;
        }
        
        .auth-tab.active {
            background: #3b82f6;
            font-weight: bold;
        }
        
        .auth-form {
            display: none;
        }
        
        .auth-form.active {
            display: block;
        }
        
        .input-box {
            margin-bottom: 20px;
        }
        
        .input-box label {
            display: block;
            margin-bottom: 8px;
            color: #94a3b8;
            font-size: 0.9rem;
        }
        
        .input-box input {
            width: 100%;
            padding: 12px 15px;
            background: #334155;
            border: 1px solid #475569;
            border-radius: 8px;
            color: white;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .input-box input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }
        
        .btn {
            padding: 14px 28px;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            margin-top: 10px;
        }
        
        .btn:hover {
            background: linear-gradient(135deg, #2563eb, #1e40af);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        
        .btn-success:hover {
            background: linear-gradient(135deg, #059669, #047857);
        }
        
        /* ========== RULES MODAL ========== */
        .rules-modal {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(15, 23, 42, 0.95);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10001;
            padding: 20px;
        }
        
        .rules-card {
            background: #1e293b;
            border: 2px solid #3b82f6;
            border-radius: 15px;
            padding: 30px;
            width: 100%;
            max-width: 800px;
            max-height: 80vh;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
            overflow-y: auto;
        }
        
        .rules-title {
            text-align: center;
            font-size: 2rem;
            margin-bottom: 25px;
            color: #60a5fa;
        }
        
        .rules-content {
            line-height: 1.6;
            color: #cbd5e1;
            white-space: pre-line;
        }
        
        .rules-section {
            margin-bottom: 25px;
        }
        
        .rules-section h3 {
            color: #60a5fa;
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 1.3rem;
        }
        
        .rules-section h4 {
            color: #94a3b8;
            margin-top: 15px;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }
        
        .rules-section ul {
            margin-left: 20px;
            margin-bottom: 15px;
        }
        
        .rules-section li {
            margin-bottom: 5px;
        }
        
        /* ========== MAIN UI ========== */
        .top-bar {
            position: fixed;
            top: 0; left: 0; right: 0;
            height: 60px;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            z-index: 1000;
            border-bottom: 2px solid #3b82f6;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #60a5fa;
        }
        
        .player-display {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .coins {
            background: rgba(245, 158, 11, 0.1);
            padding: 8px 15px;
            border-radius: 20px;
            border: 1px solid rgba(245, 158, 11, 0.3);
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: bold;
        }
        
        .role-tag {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .role-0 { background: linear-gradient(135deg, #475569, #334155); } /* –ò–≥—Ä–æ–∫ */
        .role-1 { background: linear-gradient(135deg, #8b5cf6, #7c3aed); } /* –¢–µ—Å—Ç–µ—Ä */
        .role-2 { background: linear-gradient(135deg, #3b82f6, #2563eb); } /* –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä */
        .role-3 { background: linear-gradient(135deg, #f59e0b, #d97706); color: black; } /* –ê–¥–º–∏–Ω */
        .role-4 { background: linear-gradient(135deg, #ef4444, #dc2626); animation: pulse 2s infinite; } /* –ì–ª–∞–≤–Ω—ã–π */
        
        /* ========== GAMES MENU ========== */
        .games-menu {
            position: fixed;
            top: 60px; left: 0; right: 0; bottom: 0;
            background: #0f172a;
            padding: 30px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            overflow-y: auto;
            z-index: 900;
            display: none;
        }
        
        .game-card {
            background: linear-gradient(145deg, #1e293b, #0f172a);
            border-radius: 15px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }
        
        .game-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: linear-gradient(45deg, transparent, rgba(59, 130, 246, 0.1), transparent);
            transform: translateX(-100%);
            transition: transform 0.6s;
        }
        
        .game-card:hover::before {
            transform: translateX(100%);
        }
        
        .game-card:hover {
            transform: translateY(-10px);
            border-color: #3b82f6;
            box-shadow: 0 20px 40px rgba(59, 130, 246, 0.2);
        }
        
        .game-icon {
            font-size: 3rem;
            text-align: center;
            margin-bottom: 15px;
        }
        
        .game-title {
            font-size: 1.3rem;
            font-weight: bold;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .game-desc {
            color: #94a3b8;
            text-align: center;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        /* ========== 3D CANVAS ========== */
        #gameCanvas {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 1;
            display: none;
        }
        
        /* ========== MULTIPLAYER UI ========== */
        .multiplayer-info {
            position: fixed;
            top: 70px; left: 20px;
            background: rgba(15, 23, 42, 0.9);
            border: 2px solid #10b981;
            border-radius: 10px;
            padding: 10px 15px;
            z-index: 800;
            display: none;
            font-size: 0.9rem;
        }
        
        .other-players {
            position: fixed;
            top: 110px; left: 20px;
            background: rgba(15, 23, 42, 0.9);
            border: 2px solid #3b82f6;
            border-radius: 10px;
            padding: 15px;
            z-index: 800;
            display: none;
            min-width: 200px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        /* ========== ADMIN PANEL ========== */
        .admin-panel {
            position: fixed;
            bottom: 20px; right: 20px;
            width: 400px;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            z-index: 800;
            display: none;
            border: 2px solid #3b82f6;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
        }
        
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #334155;
        }
        
        .players-list {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
        }
        
        .player-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: linear-gradient(90deg, #1e293b, #0f172a);
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid;
            transition: all 0.2s;
        }
        
        .player-item:hover {
            transform: translateX(5px);
            background: linear-gradient(90deg, #334155, #1e293b);
        }
        
        .player-0 { border-left-color: #475569; }
        .player-1 { border-left-color: #8b5cf6; }
        .player-2 { border-left-color: #3b82f6; }
        .player-3 { border-left-color: #f59e0b; }
        .player-4 { border-left-color: #ef4444; }
        
        .player-info {
            display: flex;
            flex-direction: column;
        }
        
        .player-name {
            font-weight: bold;
        }
        
        .player-role {
            font-size: 0.8rem;
            color: #94a3b8;
        }
        
        .admin-actions {
            display: flex;
            gap: 8px;
        }
        
        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .mute-btn { background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; }
        .kick-btn { background: linear-gradient(135deg, #f59e0b, #d97706); color: black; }
        .ban-btn { background: linear-gradient(135deg, #ef4444, #dc2626); color: white; }
        
        .action-btn:hover {
            transform: scale(1.1);
        }
        
        /* ========== CHAT ========== */
        .chat-box {
            position: fixed;
            bottom: 20px; left: 20px;
            width: 300px;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px;
            z-index: 800;
            display: none;
            border: 2px solid #3b82f6;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        
        .chat-messages {
            height: 200px;
            overflow-y: auto;
            margin-bottom: 10px;
            padding-right: 5px;
        }
        
        .chat-message {
            margin-bottom: 8px;
            padding: 8px;
            background: linear-gradient(90deg, #1e293b, #0f172a);
            border-radius: 8px;
            font-size: 0.9rem;
        }
        
        .chat-input {
            width: 100%;
            padding: 10px;
            background: #334155;
            border: 1px solid #475569;
            border-radius: 8px;
            color: white;
        }
        
        /* ========== NOTIFICATIONS ========== */
        .notification {
            position: fixed;
            top: 70px; right: 20px;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            z-index: 1001;
            display: none;
            animation: slideIn 0.3s ease;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            min-width: 300px;
            max-width: 400px;
        }
        
        .notification.error { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .notification.warning { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .notification.info { background: linear-gradient(135deg, #3b82f6, #2563eb); }
        
        /* ========== MOBILE WARNING ========== */
        #mobileWarning {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: #0f172a;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 30px;
            text-align: center;
            z-index: 20000;
        }
        
        /* ========== ANIMATIONS ========== */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes slideIn {
            from { transform: translateX(100px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* ========== RESPONSIVE ========== */
        @media (max-width: 768px) {
            .games-menu {
                grid-template-columns: 1fr;
                padding: 15px;
            }
            
            .admin-panel, .chat-box {
                width: calc(100% - 40px);
                right: 20px;
                left: 20px;
            }
            
            .top-bar {
                padding: 0 10px;
            }
            
            .player-display {
                gap: 8px;
            }
        }
    </style>
</head>
<body>
    <!-- LOADING -->
    <div id="loadingScreen">
        <div class="spinner"></div>
        <div style="margin-top: 20px; font-size: 1.5rem;">StelsCity v1.0.0</div>
        <div style="margin-top: 10px; color: #94a3b8;">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>

    <!-- RULES MODAL -->
    <div class="rules-modal" id="rulesModal">
        <div class="rules-card">
            <div class="rules-title">üìú –ü—Ä–∞–≤–∏–ª–∞ StelsCity [–≤–µ—Ä—Å–∏—è –ø—Ä–∞–≤–∏–ª v1]</div>
            <div class="rules-content">
                
### üëÆ **–ü–†–ê–í–ò–õ–ê –°–û–û–ë–©–ï–°–¢–í–ê**

1. **–£–≤–∞–∂–µ–Ω–∏–µ –∫ –¥—Ä—É–≥–∏–º –∏–≥—Ä–æ–∫–∞–º**
   - –ó–∞–ø—Ä–µ—â–µ–Ω—ã –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è, –¥–∏—Å–∫—Ä–∏–º–∏–Ω–∞—Ü–∏—è, —Ç—Ä–∞–≤–ª—è
   - –†–∞–∑—Ä–µ—à–µ–Ω–∞ –∑–¥–æ—Ä–æ–≤–∞—è –∫—Ä–∏—Ç–∏–∫–∞, –∑–∞–ø—Ä–µ—â—ë–Ω —Ö–µ–π—Ç

2. **–ß–µ—Å—Ç–Ω–∞—è –∏–≥—Ä–∞**
   - –ó–∞–ø—Ä–µ—â—ë–Ω —á–∏—Ç–µ—Ä—Å—Ç–≤–æ, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–∞–≥–æ–≤, —ç–∫—Å–ø–ª–æ–π—Ç–æ–≤
   - –ó–∞–ø—Ä–µ—â—ë–Ω –±—É–ª–ª–∏–Ω–≥ –Ω–æ–≤–∏—á–∫–æ–≤

3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç–æ–≤**
   - –ó–∞–ø—Ä–µ—â—ë–Ω –æ–±–º–µ–Ω –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏
   - –ó–∞–ø—Ä–µ—â—ë–Ω —Å–ø–∞–º, —Ñ–ª—É–¥, —Ä–µ–∫–ª–∞–º–∞
   - –ó–∞–ø—Ä–µ—â–µ–Ω–æ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

4. **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏**
   - –ü–æ –º–µ–ª–∫–∏–º –≤–æ–ø—Ä–æ—Å–∞–º –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞–º
   - –ü–æ —Å–µ—Ä—å—ë–∑–Ω—ã–º –ø—Ä–æ–±–ª–µ–º–∞–º - –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º
   - –ù–µ –±–µ—Å–ø–æ–∫–æ–π—Ç–µ –≥–ª–∞–≤–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –ø–æ –∫–∞–∂–¥–æ–º—É –ø–æ–≤–æ–¥—É
   - –ê–¥–º–∏–Ω—ã –∏ –º–æ–¥–µ—Ä—ã –∫–æ–º–ø–µ—Ç–µ–Ω—Ç–Ω—ã —Ä–µ—à–∞—Ç—å –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤

### üõ°Ô∏è **–°–ò–°–¢–ï–ú–ê –ú–û–î–ï–†–ê–¶–ò–ò**

**–†–æ–ª–∏ –∏ –ø—Ä–∞–≤–∞:**
- üë§ **–ò–≥—Ä–æ–∫** - –æ–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- üß™ **–¢–µ—Å—Ç–µ—Ä** - –º–æ–∂–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å, –∏–º–µ–µ—Ç –ø—Ä–∞–≤–æ –Ω–∞ –º—É—Ç
- üõ°Ô∏è **–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä** - –º–æ–∂–µ—Ç –º—É—Ç–∏—Ç—å –∏ –∫–∏–∫–∞—Ç—å –∏–≥—Ä–æ–∫–æ–≤
- ‚ö° **–ê–¥–º–∏–Ω** - –º–æ–∂–µ—Ç –º—É—Ç–∏—Ç—å, –∫–∏–∫–∞—Ç—å –∏ –±–∞–Ω–∏—Ç—å
- üëë **–ì–ª–∞–≤–Ω—ã–π –ê–¥–º–∏–Ω** - –ø–æ–ª–Ω—ã–µ –ø—Ä–∞–≤–∞, –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

**–ù–∞–∫–∞–∑–∞–Ω–∏—è:**
- –ú—É—Ç —á–∞—Ç–∞ (–≤—Ä–µ–º–µ–Ω–Ω—ã–π/–ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π)
- –ö–∏–∫ —Å —Å–µ—Ä–≤–µ—Ä–∞
- –ë–∞–Ω –∞–∫–∫–∞—É–Ω—Ç–∞
- –°–±—Ä–æ—Å –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

### üí¨ **–ü–†–ê–í–ò–õ–ê –ß–ê–¢–ê**

1. **–ú–æ–∂–Ω–æ:**
   - –û–±—Å—É–∂–¥–∞—Ç—å –∏–≥—Ä—É
   - –ü–æ–º–æ–≥–∞—Ç—å –Ω–æ–≤–∏—á–∫–∞–º
   - –û—Ä–≥–∞–Ω–∏–∑–æ–≤—ã–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã

2. **–ù–µ–ª—å–∑—è:**
   - –ú–∞—Ç –∏ –Ω–µ–Ω–æ—Ä–º–∞—Ç–∏–≤–Ω–∞—è –ª–µ–∫—Å–∏–∫–∞
   - –ö–∞–ø—Å (–∑–∞–≥–ª–∞–≤–Ω—ã–µ –±—É–∫–≤—ã)
   - –§–ª—É–¥ (–ø–æ–≤—Ç–æ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π)
   - –û—Ñ—Ñ—Ç–æ–ø (–Ω–µ –ø–æ —Ç–µ–º–µ –∏–≥—Ä—ã)
   - –°—Å—ã–ª–∫–∏ (–∫—Ä–æ–º–µ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã—Ö)

### üéÆ **–ü–†–ê–í–ò–õ–ê –ò–ì–†**

1. **99 –ù–æ—á–µ–π:**
   - –ù–µ –º–µ—à–∞—Ç—å –¥—Ä—É–≥–∏–º –≤—ã–∂–∏–≤–∞—Ç—å
   - –†–∞–±–æ—Ç–∞—Ç—å –≤ –∫–æ–º–∞–Ω–¥–µ —Å –¥—Ä—É–≥–∏–º–∏ –∏–≥—Ä–æ–∫–∞–º–∏

2. **–ü–∞—Ä–∫—É—Ä:**
   - –ù–µ —Ç–æ–ª–∫–∞—Ç—å –¥—Ä—É–≥–∏—Ö –∏–≥—Ä–æ–∫–æ–≤
   - –ù–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ö–æ–¥—ã

3. **–ë–∏—Ç–≤–∞:**
   - –ß–∏—Å—Ç—ã–π PvP –±–µ–∑ —á–∏—Ç–æ–≤
   - –£–≤–∞–∂–µ–Ω–∏–µ –∫ –ø–æ–±–µ–∂–¥—ë–Ω–Ω—ã–º

4. **–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ:**
   - –ù–µ —Ä–∞–∑—Ä—É—à–∞—Ç—å —á—É–∂–∏–µ –ø–æ—Å—Ç—Ä–æ–π–∫–∏
   - –°–æ–≤–º–µ—Å—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∞

### ‚öñÔ∏è **–ê–ü–ï–õ–õ–Ø–¶–ò–ò**

1. –û—à–∏–±–∫–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ ‚Üí –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É
2. –ù–µ—Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤—ã–π –±–∞–Ω ‚Üí –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É
3. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã ‚Üí –±–∞–≥-—Ä–µ–ø–æ—Ä—Ç

### üìã **–¢–ï–†–ú–ò–ù–´**

- **–ú—É—Ç** - –∑–∞–ø—Ä–µ—Ç –ø–∏—Å–∞—Ç—å –≤ —á–∞—Ç
- **–ö–∏–∫** - –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–∞
- **–ë–∞–Ω** - –ø–æ—Å—Ç–æ—è–Ω–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–∞
- **–í–∞—Ä–Ω** - –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ

### üëë **–ü–†–ê–í–ê –ì–õ–ê–í–ù–û–ì–û –ê–î–ú–ò–ù–ê**

–¢–æ–ª—å–∫–æ –≥–ª–∞–≤–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –∏–º–µ–µ—Ç –ø—Ä–∞–≤–æ:
1. –ù–∞–∑–Ω–∞—á–∞—Ç—å –∏ —Å–Ω–∏–º–∞—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
2. –ò–∑–º–µ–Ω—è—Ç—å –ø—Ä–∞–≤–∏–ª–∞ —Å–µ—Ä–≤–µ—Ä–∞
3. –ü—Ä–∏–Ω–∏–º–∞—Ç—å –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è
4. –î–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏—è–º

### ‚ö†Ô∏è **–í–ê–ñ–ù–û**

–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è –æ—Å—Ç–∞–≤–ª—è–µ—Ç –∑–∞ —Å–æ–±–æ–π –ø—Ä–∞–≤–æ:
- –ò–∑–º–µ–Ω—è—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –±–µ–∑ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
- –ù–∞–∫–∞–∑—ã–≤–∞—Ç—å –∑–∞ –Ω–µ–ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è
- –¢–æ–ª–∫–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –ø–æ —Å–≤–æ–µ–º—É —É—Å–º–æ—Ç—Ä–µ–Ω–∏—é

**–ò–≥—Ä–∞—è –≤ StelsCity, –≤—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å —ç—Ç–∏–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏.**

---
*2026 –≥–æ–¥ | –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã*
            </div>
            <button class="btn" onclick="closeRules()" style="margin-top: 20px;">–ü–æ–Ω—è—Ç–Ω–æ</button>
        </div>
    </div>

    <!-- LOGIN SCREEN -->
    <div id="loginScreen" class="auth-screen">
        <div class="auth-card">
            <div class="auth-title">üéÆ –í—Ö–æ–¥ –≤ StelsCity</div>
            
            <div class="auth-tabs">
                <div class="auth-tab active" onclick="showAuthForm('login')">–í—Ö–æ–¥</div>
                <div class="auth-tab" onclick="showAuthForm('register')">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</div>
            </div>
            
            <!-- LOGIN FORM -->
            <div id="loginForm" class="auth-form active">
                <div class="input-box">
                    <label>üìß Email</label>
                    <input type="email" id="loginEmail" placeholder="example@mail.com" value="player@stelscity.com">
                </div>
                
                <div class="input-box">
                    <label>üîë –ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="loginPassword" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" value="9889">
                </div>
                
                <button class="btn btn-success" onclick="login()">–í–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç</button>
                <button class="btn" onclick="showRules()" style="margin-top: 15px; background: #475569;">üìú –ü—Ä–∞–≤–∏–ª–∞</button>
            </div>
            
            <!-- REGISTER FORM -->
            <div id="registerForm" class="auth-form">
                <div class="input-box">
                    <label>üë§ –ò–º—è –∏–≥—Ä–æ–∫–∞</label>
                    <input type="text" id="registerName" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è" maxlength="16">
                </div>
                
                <div class="input-box">
                    <label>üìß Email</label>
                    <input type="email" id="registerEmail" placeholder="example@mail.com">
                </div>
                
                <div class="input-box">
                    <label>üîë –ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="registerPassword" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å">
                </div>
                
                <div class="input-box">
                    <label>üîë –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
                    <input type="password" id="registerPasswordConfirm" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                </div>
                
                <button class="btn" onclick="register()">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
                <button class="btn" onclick="showRules()" style="margin-top: 15px; background: #475569;">üìú –ü—Ä–∞–≤–∏–ª–∞</button>
            </div>
        </div>
    </div>

    <!-- MOBILE WARNING -->
    <div id="mobileWarning">
        <div style="font-size: 4rem; margin-bottom: 20px;">üì±</div>
        <div style="font-size: 1.8rem; margin-bottom: 10px; color: #ef4444;">–¢–æ–ª—å–∫–æ –¥–ª—è –ü–ö!</div>
        <div style="color: #94a3b8; max-width: 400px; line-height: 1.5;">
            StelsCity v1.0.0 —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –¥–ª—è –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–≤.
            –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ü–ö –∏–ª–∏ –Ω–æ—É—Ç–±—É–∫ –¥–ª—è –∏–≥—Ä—ã.
        </div>
    </div>

    <!-- 3D CANVAS -->
    <canvas id="gameCanvas"></canvas>

    <!-- TOP BAR -->
    <div class="top-bar">
        <div class="logo">üéÆ StelsCity v1.0.0</div>
        <div class="player-display">
            <div class="coins">üí∞ <span id="coinsValue">1000</span></div>
            <div class="role-tag role-0" id="playerRoleBadge">–ò–≥—Ä–æ–∫</div>
            <div id="playerNameDisplay">–ò–≥—Ä–æ–∫</div>
            <button onclick="showRules()" style="background: #475569; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer;">üìú –ü—Ä–∞–≤–∏–ª–∞</button>
            <button onclick="logout()" style="background: #ef4444; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer;">–í—ã–π—Ç–∏</button>
        </div>
    </div>

    <!-- GAMES MENU -->
    <div class="games-menu" id="gamesMenu">
        <div class="game-card" onclick="startGame('99nights')">
            <div class="game-icon">üßü</div>
            <div class="game-title">99 –ù–æ—á–µ–π</div>
            <div class="game-desc">–í—ã–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ—Ç–∏–≤ –∑–æ–º–±–∏ —Å –¥—Ä—É–≥–∏–º–∏ –∏–≥—Ä–æ–∫–∞–º–∏</div>
        </div>
        
        <div class="game-card" onclick="startGame('parkour')">
            <div class="game-icon">üèÉ</div>
            <div class="game-title">–ü–∞—Ä–∫—É—Ä</div>
            <div class="game-desc">–ü–æ–ª–æ—Å–∞ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</div>
        </div>
        
        <div class="game-card" onclick="startGame('battle')">
            <div class="game-icon">‚öîÔ∏è</div>
            <div class="game-title">–ë–∏—Ç–≤–∞</div>
            <div class="game-desc">–°—Ä–∞–∂–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏–º–∏ –∏–≥—Ä–æ–∫–∞–º–∏ –Ω–∞ –∞—Ä–µ–Ω–µ</div>
        </div>
        
        <div class="game-card" onclick="startGame('build')">
            <div class="game-icon">üèóÔ∏è</div>
            <div class="game-title">–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ</div>
            <div class="game-desc">–°—Ç—Ä–æ–π—Ç–µ –≤–º–µ—Å—Ç–µ —Å –¥—Ä—É–≥–∏–º–∏ –∏–≥—Ä–æ–∫–∞–º–∏</div>
        </div>
    </div>

    <!-- MULTIPLAYER INFO -->
    <div class="multiplayer-info" id="multiplayerInfo">
        <div style="color: #10b981; font-weight: bold;">üü¢ –ú—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä –∞–∫—Ç–∏–≤–µ–Ω</div>
        <div style="font-size: 0.8rem; color: #94a3b8;">–ò–≥—Ä–æ–∫–æ–≤ –æ–Ω–ª–∞–π–Ω: <span id="onlineCount">1</span></div>
    </div>

    <!-- OTHER PLAYERS LIST -->
    <div class="other-players" id="otherPlayers">
        <div style="font-weight: bold; margin-bottom: 10px;">üë• –î—Ä—É–≥–∏–µ –∏–≥—Ä–æ–∫–∏:</div>
        <div id="playersListContainer"></div>
    </div>

    <!-- CHAT -->
    <div class="chat-box" id="chatBox">
        <div class="chat-messages" id="chatMessages"></div>
        <input type="text" class="chat-input" id="chatInput" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." onkeypress="if(event.key === 'Enter') sendChat()">
    </div>

    <!-- ADMIN PANEL -->
    <div class="admin-panel" id="adminPanel">
        <div class="admin-header">
            <div>üë• –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (<span id="adminOnlineCount">0</span>)</div>
            <div style="font-size: 0.8rem; color: #94a3b8;">TAB</div>
        </div>
        
        <div class="players-list" id="adminPlayersList">
            <!-- –ê–¥–º–∏–Ω —Å–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤ -->
        </div>
        
        <div style="text-align: center; color: #94a3b8; font-size: 0.8rem;">
            –í–∞—à–∞ —Ä–æ–ª—å: <span id="currentRoleName">–ò–≥—Ä–æ–∫</span>
        </div>
    </div>

    <!-- NOTIFICATION -->
    <div class="notification" id="notification"></div>

    <!-- PEERJS SCRIPT -->
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <!-- THREE.JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <script>
        // ==================== –ö–û–ù–°–¢–ê–ù–¢–´ ====================
        const MAIN_ADMIN_EMAIL = "andreystels0000000000@outlook.com";
        const MAIN_ADMIN_PASSWORD = "V@o0j0e88I";
        const MAIN_ADMIN_NAME = "MrStels";
        
        let currentUser = null;
        let currentGame = null;
        let scene, camera, renderer, playerMesh;
        let animationId = null;
        let adminPanelVisible = false;
        
        // –ú–£–õ–¨–¢–ò–ü–õ–ï–ï–†
        let peer = null;
        let myPeerId = null;
        let connections = {};
        let otherPlayers = {};
        let playerMeshes = {};
        
        // –†–û–õ–ò
        const ROLES = [
            { id: 0, name: "–ò–≥—Ä–æ–∫", color: "#475569", icon: "üë§", canMute: false, canKick: false, canBan: false },
            { id: 1, name: "–¢–µ—Å—Ç–µ—Ä", color: "#8b5cf6", icon: "üß™", canMute: true, canKick: false, canBan: false },
            { id: 2, name: "–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä", color: "#3b82f6", icon: "üõ°Ô∏è", canMute: true, canKick: true, canBan: false },
            { id: 3, name: "–ê–¥–º–∏–Ω", color: "#f59e0b", icon: "‚ö°", canMute: true, canKick: true, canBan: true },
            { id: 4, name: "–ì–ª–∞–≤–Ω—ã–π", color: "#ef4444", icon: "üëë", canMute: true, canKick: true, canBan: true }
        ];
        
        // –ü–†–ï–î–£–°–¢–ê–ù–û–í–õ–ï–ù–ù–´–ï –ê–ö–ö–ê–£–ù–¢–´
        const TEST_USERS = [
            { id: "player1", name: "–ò–≥—Ä–æ–∫_1", email: "player@stelscity.com", password: "9889", role: 0, coins: 500 },
            { id: "player2", name: "–¢–µ—Å—Ç–µ—Ä_1", email: "tester@stelscity.com", password: "9889", role: 1, coins: 1200 },
            { id: "player3", name: "–ú–æ–¥–µ—Ä_1", email: "moder@stelscity.com", password: "9889", role: 2, coins: 2000 },
            { id: "player4", name: "–ê–¥–º–∏–Ω_1", email: "admin@stelscity.com", password: "9889", role: 3, coins: 5000 },
            { id: "player5", name: MAIN_ADMIN_NAME, email: MAIN_ADMIN_EMAIL, password: MAIN_ADMIN_PASSWORD, role: 4, coins: 9999 }
        ];
        
        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
        async function init() {
            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                document.getElementById('loadingScreen').style.display = 'none';
                document.getElementById('mobileWarning').style.display = 'flex';
                return;
            }
            
            await loadUserData();
            
            if (!currentUser) {
                showLoginScreen();
            } else {
                showMainMenu();
            }
            
            document.getElementById('loadingScreen').style.display = 'none';
            initMultiplayer();
        }
        
        // ==================== –ü–†–ê–í–ò–õ–ê ====================
        function showRules() {
            document.getElementById('rulesModal').style.display = 'flex';
        }
        
        function closeRules() {
            document.getElementById('rulesModal').style.display = 'none';
        }
        
        // ==================== –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø ====================
        async function loadUserData() {
            try {
                const saved = localStorage.getItem('stelscity_current_user');
                if (saved) {
                    currentUser = JSON.parse(saved);
                    updateUI();
                    return true;
                }
            } catch(e) {
                console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:", e);
            }
            return false;
        }
        
        function saveUserData() {
            if (currentUser) {
                localStorage.setItem('stelscity_current_user', JSON.stringify(currentUser));
                localStorage.setItem('stelscity_users', JSON.stringify(getAllUsers()));
            }
        }
        
        function getAllUsers() {
            try {
                const saved = localStorage.getItem('stelscity_users');
                if (saved) return JSON.parse(saved);
            } catch(e) {}
            
            const users = {};
            TEST_USERS.forEach(user => {
                users[user.email] = user;
            });
            localStorage.setItem('stelscity_users', JSON.stringify(users));
            return users;
        }
        
        function showLoginScreen() {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('loginEmail').value = 'player@stelscity.com';
            document.getElementById('loginPassword').value = '9889';
        }
        
        function showAuthForm(form) {
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            
            document.getElementById(form + 'Form').classList.add('active');
            document.querySelector(`.auth-tab[onclick*="${form}"]`).classList.add('active');
        }
        
        function login() {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value.trim();
            
            if (!email || !password) {
                showNotification("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!", "error");
                return;
            }
            
            const users = getAllUsers();
            const user = users[email];
            
            if (!user) {
                showNotification("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω!", "error");
                return;
            }
            
            if (user.password !== password) {
                showNotification("–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!", "error");
                return;
            }
            
            currentUser = { ...user };
            
            if (email === MAIN_ADMIN_EMAIL && password === MAIN_ADMIN_PASSWORD) {
                currentUser.name = MAIN_ADMIN_NAME;
                currentUser.role = 4;
            }
            
            saveUserData();
            document.getElementById('loginScreen').style.display = 'none';
            showMainMenu();
            showNotification(`–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${currentUser.name}!`, "info");
        }
        
        function register() {
            const name = document.getElementById('registerName').value.trim();
            const email = document.getElementById('registerEmail').value.trim();
            const password = document.getElementById('registerPassword').value.trim();
            const confirmPassword = document.getElementById('registerPasswordConfirm').value.trim();
            
            if (!name || !email || !password || !confirmPassword) {
                showNotification("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!", "error");
                return;
            }
            
            if (password !== confirmPassword) {
                showNotification("–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç!", "error");
                return;
            }
            
            if (password.length < 6) {
                showNotification("–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤!", "error");
                return;
            }
            
            const users = getAllUsers();
            
            if (users[email]) {
                showNotification("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!", "error");
                return;
            }
            
            let role = 0;
            
            if (email === MAIN_ADMIN_EMAIL && password === MAIN_ADMIN_PASSWORD) {
                role = 4;
                showNotification("üîê –î–æ—Å—Ç—É–ø –ì–ª–∞–≤–Ω–æ–≥–æ –ê–¥–º–∏–Ω–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!", "info");
            }
            
            const newUser = {
                id: 'user_' + Date.now(),
                name: name,
                email: email,
                password: password,
                role: role,
                coins: 1000,
                createdAt: Date.now()
            };
            
            users[email] = newUser;
            localStorage.setItem('stelscity_users', JSON.stringify(users));
            
            currentUser = newUser;
            saveUserData();
            
            document.getElementById('loginScreen').style.display = 'none';
            showMainMenu();
            showNotification(`–ê–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞–Ω! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${name}!`, "info");
        }
        
        function logout() {
            if (confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?")) {
                currentUser = null;
                localStorage.removeItem('stelscity_current_user');
                location.reload();
            }
        }
        
        // ==================== –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ ====================
        function showMainMenu() {
            updateUI();
            document.getElementById('gamesMenu').style.display = 'grid';
            document.getElementById('multiplayerInfo').style.display = 'none';
            document.getElementById('otherPlayers').style.display = 'none';
            document.getElementById('chatBox').style.display = 'none';
            document.getElementById('adminPanel').style.display = 'none';
        }
        
        function updateUI() {
            if (!currentUser) return;
            
            document.getElementById('playerNameDisplay').textContent = currentUser.name;
            document.getElementById('coinsValue').textContent = currentUser.coins;
            
            const role = ROLES[currentUser.role];
            document.getElementById('playerRoleBadge').textContent = role.name;
            document.getElementById('playerRoleBadge').className = `role-tag role-${currentUser.role}`;
            document.getElementById('currentRoleName').textContent = role.name;
        }
        
        // ==================== –ò–ì–†–´ ====================
        function startGame(gameType) {
            currentGame = gameType;
            document.getElementById('gamesMenu').style.display = 'none';
            document.getElementById('gameCanvas').style.display = 'block';
            document.getElementById('multiplayerInfo').style.display = 'block';
            document.getElementById('otherPlayers').style.display = 'block';
            document.getElementById('chatBox').style.display = 'block';
            document.getElementById('adminPanel').style.display = 'none';
            
            adminPanelVisible = false;
            
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
            
            init3DScene(gameType);
            showNotification(`–ò–≥—Ä–∞ "${getGameName(gameType)}" –Ω–∞—á–∞–ª–∞—Å—å!`, "info");
            
            if (currentUser) {
                currentUser.coins += 50;
                updateUI();
                saveUserData();
            }
            
            initGameMultiplayer();
        }
        
        function getGameName(type) {
            const games = {
                '99nights': '99 –ù–æ—á–µ–π',
                'parkour': '–ü–∞—Ä–∫—É—Ä',
                'battle': '–ë–∏—Ç–≤–∞',
                'build': '–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ'
            };
            return games[type] || '–ò–≥—Ä–∞';
        }
        
        function init3DScene(gameType) {
            // –°–û–ó–î–ê–ï–ú –°–¶–ï–ù–£ –° –£–õ–£–ß–®–ï–ù–ù–û–ô –ì–†–ê–§–ò–ö–û–ô
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ 
                canvas: document.getElementById('gameCanvas'), 
                antialias: true,
                alpha: true
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            
            // –û–ß–ò–©–ê–ï–ú –°–¶–ï–ù–£
            while(scene.children.length > 0) {
                scene.remove(scene.children[0]);
            }
            
            // –û–ß–ò–©–ê–ï–ú –ò–ì–†–û–ö–û–í
            playerMeshes = {};
            
            // –ù–ï–ë–û–°–í–û–î
            scene.background = new THREE.Color(0x0f172a);
            
            // –û–°–í–ï–©–ï–ù–ò–ï
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
            directionalLight.position.set(10, 20, 15);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 2048;
            directionalLight.shadow.mapSize.height = 2048;
            directionalLight.shadow.camera.near = 0.5;
            directionalLight.shadow.camera.far = 500;
            directionalLight.shadow.camera.left = -100;
            directionalLight.shadow.camera.right = 100;
            directionalLight.shadow.camera.top = 100;
            directionalLight.shadow.camera.bottom = -100;
            scene.add(directionalLight);
            
            // –ü–û–õ (—É–ª—É—á—à–µ–Ω–Ω—ã–π)
            const floorGeometry = new THREE.PlaneGeometry(100, 100);
            const floorMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x1e293b,
                roughness: 0.7,
                metalness: 0.1
            });
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            floor.receiveShadow = true;
            scene.add(floor);
            
            // –¢–ï–ö–°–¢–£–†–ê –ü–û–õ–ê (—Å–µ—Ç–∫–∞)
            const gridHelper = new THREE.GridHelper(100, 50, 0x334155, 0x475569);
            gridHelper.position.y = 0.01;
            scene.add(gridHelper);
            
            // –ò–ì–†–û–ö (—É–ª—É—á—à–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å)
            const playerGeometry = new THREE.BoxGeometry(1, 2, 1);
            const playerMaterial = new THREE.MeshStandardMaterial({ 
                color: ROLES[currentUser?.role || 0].color,
                roughness: 0.4,
                metalness: 0.2,
                emissive: ROLES[currentUser?.role || 0].color,
                emissiveIntensity: 0.1
            });
            playerMesh = new THREE.Mesh(playerGeometry, playerMaterial);
            playerMesh.position.set(0, 1, 0);
            playerMesh.castShadow = true;
            scene.add(playerMesh);
            
            // –û–ë–™–ï–ö–¢–´ –í –ó–ê–í–ò–°–ò–ú–û–°–¢–ò –û–¢ –ò–ì–†–´
            if (gameType === '99nights') {
                // –ó–û–ú–ë–ò
                for (let i = 0; i < 8; i++) {
                    const zombieGeometry = new THREE.BoxGeometry(1, 2, 1);
                    const zombieMaterial = new THREE.MeshStandardMaterial({ 
                        color: 0x00ff00,
                        roughness: 0.6,
                        metalness: 0.3,
                        emissive: 0x004400,
                        emissiveIntensity: 0.2
                    });
                    const zombie = new THREE.Mesh(zombieGeometry, zombieMaterial);
                    zombie.position.set(
                        Math.random() * 40 - 20,
                        1,
                        Math.random() * 40 - 20
                    );
                    zombie.castShadow = true;
                    scene.add(zombie);
                }
                
                // –°–¢–ï–ù–´
                const wallGeometry = new THREE.BoxGeometry(50, 5, 2);
                const wallMaterial = new THREE.MeshStandardMaterial({ 
                    color: 0x475569,
                    roughness: 0.5,
                    metalness: 0.2
                });
                
                const walls = [
                    { pos: [0, 2.5, -25], rot: [0, 0, 0] },
                    { pos: [0, 2.5, 25], rot: [0, 0, 0] },
                    { pos: [-25, 2.5, 0], rot: [0, Math.PI/2, 0] },
                    { pos: [25, 2.5, 0], rot: [0, Math.PI/2, 0] }
                ];
                
                walls.forEach(wallData => {
                    const wall = new THREE.Mesh(wallGeometry, wallMaterial);
                    wall.position.set(...wallData.pos);
                    wall.rotation.set(...wallData.rot);
                    wall.castShadow = true;
                    wall.receiveShadow = true;
                    scene.add(wall);
                });
                
            } else if (gameType === 'parkour') {
                // –ü–ê–†–ö–£–† –ü–õ–ê–¢–§–û–†–ú–´
                const platformGeometry = new THREE.BoxGeometry(3, 0.5, 3);
                const platformMaterial = new THREE.MeshStandardMaterial({ 
                    color: 0x3b82f6,
                    roughness: 0.3,
                    metalness: 0.5,
                    emissive: 0x1e40af,
                    emissiveIntensity: 0.1
                });
                
                for (let i = 0; i < 10; i++) {
                    const platform = new THREE.Mesh(platformGeometry, platformMaterial);
                    platform.position.set(
                        Math.sin(i * 0.7) * 15,
                        i * 2.5,
                        Math.cos(i * 0.7) * 15
                    );
                    platform.castShadow = true;
                    platform.receiveShadow = true;
                    scene.add(platform);
                }
                
            } else if (gameType === 'battle') {
                // –ê–†–ï–ù–ê
                const arenaGeometry = new THREE.CylinderGeometry(20, 20, 0.5, 32);
                const arenaMaterial = new THREE.MeshStandardMaterial({ 
                    color: 0xef4444,
                    roughness: 0.5,
                    metalness: 0.3
                });
                const arena = new THREE.Mesh(arenaGeometry, arenaMaterial);
                arena.receiveShadow = true;
                scene.add(arena);
                
                // –ü–†–ï–ü–Ø–¢–°–¢–í–ò–Ø
                for (let i = 0; i < 8; i++) {
                    const obstacleGeometry = new THREE.BoxGeometry(3, 4, 3);
                    const obstacleMaterial = new THREE.MeshStandardMaterial({ 
                        color: 0x64748b,
                        roughness: 0.4,
                        metalness: 0.3
                    });
                    const obstacle = new THREE.Mesh(obstacleGeometry, obstacleMaterial);
                    const angle = (i / 8) * Math.PI * 2;
                    obstacle.position.set(
                        Math.cos(angle) * 12,
                        2,
                        Math.sin(angle) * 12
                    );
                    obstacle.castShadow = true;
                    scene.add(obstacle);
                }
                
            } else if (gameType === 'build') {
                // –°–¢–†–û–ò–¢–ï–õ–¨–ù–´–ï –ë–õ–û–ö–ò
                const blockGeometry = new THREE.BoxGeometry(1, 1, 1);
                const colors = [
                    0x3b82f6, 0xef4444, 0x10b981, 
                    0xf59e0b, 0x8b5cf6, 0xec4899
                ];
                
                for (let x = -5; x <= 5; x++) {
                    for (let z = -5; z <= 5; z++) {
                        const color = colors[(x + 5 + (z + 5) * 11) % colors.length];
                        const blockMaterial = new THREE.MeshStandardMaterial({ 
                            color: color,
                            roughness: 0.4,
                            metalness: 0.2
                        });
                        const block = new THREE.Mesh(blockGeometry, blockMaterial);
                        block.position.set(x * 2, 0.5, z * 2);
                        block.castShadow = true;
                        scene.add(block);
                    }
                }
            }
            
            // –ö–ê–ú–ï–†–ê
            camera.position.set(0, 15, 25);
            camera.lookAt(0, 0, 0);
            
            // –†–ï–°–ê–ô–ó
            window.addEventListener('resize', onWindowResize);
            
            // –ó–ê–ü–£–°–ö –ê–ù–ò–ú–ê–¶–ò–ò
            animate();
        }
        
        function animate() {
            animationId = requestAnimationFrame(animate);
            
            // –ê–ù–ò–ú–ê–¶–ò–Ø –ò–ì–†–û–ö–ê
            if (playerMesh) {
                const time = Date.now() * 0.001;
                
                // –ü–ª–∞–≤–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –ø–æ –∫—Ä—É–≥—É
                playerMesh.position.x = Math.sin(time) * 5;
                playerMesh.position.z = Math.cos(time) * 5;
                
                // –õ–µ–≥–∫–æ–µ –ø–æ–∫–∞—á–∏–≤–∞–Ω–∏–µ
                playerMesh.rotation.y = time;
                playerMesh.position.y = 1 + Math.sin(time * 5) * 0.1;
                
                // –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ–∑–∏—Ü–∏–∏ –¥—Ä—É–≥–∏–º –∏–≥—Ä–æ–∫–∞–º
                if (currentGame) {
                    sendToAll({
                        type: 'player_position',
                        x: playerMesh.position.x,
                        y: playerMesh.position.y,
                        z: playerMesh.position.z
                    });
                }
            }
            
            // –í–†–ê–©–ï–ù–ò–ï –ö–ê–ú–ï–†–´
            const cameraTime = Date.now() * 0.0003;
            camera.position.x = Math.sin(cameraTime) * 25;
            camera.position.z = Math.cos(cameraTime) * 25;
            camera.lookAt(0, 0, 0);
            
            renderer.render(scene, camera);
        }
        
        function onWindowResize() {
            if (camera && renderer) {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            }
        }
        
        function stopGame() {
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
            
            document.getElementById('gameCanvas').style.display = 'none';
            document.getElementById('multiplayerInfo').style.display = 'none';
            document.getElementById('otherPlayers').style.display = 'none';
            document.getElementById('chatBox').style.display = 'none';
            document.getElementById('adminPanel').style.display = 'none';
            
            currentGame = null;
            showMainMenu();
        }
        
        // ==================== –ú–£–õ–¨–¢–ò–ü–õ–ï–ï–† ====================
        function initMultiplayer() {
            try {
                myPeerId = 'player_' + Math.random().toString(36).substr(2, 9);
                
                peer = new Peer(myPeerId, {
                    host: '0.peerjs.com',
                    port: 443,
                    path: '/',
                    secure: true,
                    debug: 2
                });
                
                peer.on('open', (id) => {
                    console.log('Peer —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ:', id);
                    myPeerId = id;
                });
                
                peer.on('connection', (conn) => {
                    console.log('–ù–æ–≤–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ:', conn.peer);
                    setupConnection(conn);
                });
                
                peer.on('error', (err) => {
                    console.error('Peer –æ—à–∏–±–∫–∞:', err);
                    initMultiplayerFallback();
                });
                
            } catch(e) {
                console.error('–û—à–∏–±–∫–∞ PeerJS:', e);
                initMultiplayerFallback();
            }
        }
        
        function initMultiplayerFallback() {
            setInterval(syncMultiplayerData, 1000);
        }
        
        function syncMultiplayerData() {
            if (!currentGame || !currentUser) return;
            
            const playerData = {
                id: myPeerId || currentUser.id,
                name: currentUser.name,
                role: currentUser.role,
                game: currentGame,
                position: playerMesh ? { 
                    x: playerMesh.position.x, 
                    y: playerMesh.position.y, 
                    z: playerMesh.position.z 
                } : { x: 0, y: 0, z: 0 },
                timestamp: Date.now()
            };
            
            localStorage.setItem('stelscity_multiplayer_' + myPeerId, JSON.stringify(playerData));
            
            const allKeys = Object.keys(localStorage);
            const otherPlayersData = [];
            
            for (const key of allKeys) {
                if (key.startsWith('stelscity_multiplayer_') && !key.includes(myPeerId)) {
                    try {
                        const data = JSON.parse(localStorage.getItem(key));
                        if (data.game === currentGame && Date.now() - data.timestamp < 5000) {
                            otherPlayersData.push(data);
                        }
                    } catch(e) {}
                }
            }
            
            updateOtherPlayers(otherPlayersData);
        }
        
        function updateOtherPlayers(playersData) {
            const container = document.getElementById('playersListContainer');
            if (container) {
                container.innerHTML = playersData.map(player => `
                    <div style="margin-bottom: 5px; padding: 8px; background: #334155; border-radius: 5px;">
                        <div style="font-weight: bold;">${player.name}</div>
                        <div style="font-size: 0.7rem; color: ${ROLES[player.role].color};">${ROLES[player.role].name}</div>
                    </div>
                `).join('');
                
                const onlineCount = playersData.length + 1;
                document.getElementById('onlineCount').textContent = onlineCount;
                document.getElementById('adminOnlineCount').textContent = onlineCount;
            }
            
            updateOtherPlayerMeshes(playersData);
        }
        
        function updateOtherPlayerMeshes(playersData) {
            if (!scene) return;
            
            // –£–î–ê–õ–Ø–ï–ú –°–¢–ê–†–´–• –ò–ì–†–û–ö–û–í
            Object.keys(playerMeshes).forEach(id => {
                if (!playersData.find(p => p.id === id)) {
                    scene.remove(playerMeshes[id]);
                    delete playerMeshes[id];
                }
            });
            
            // –î–û–ë–ê–í–õ–Ø–ï–ú/–û–ë–ù–û–í–õ–Ø–ï–ú –ò–ì–†–û–ö–û–í
            playersData.forEach(player => {
                if (!playerMeshes[player.id]) {
                    const geometry = new THREE.BoxGeometry(1, 2, 1);
                    const material = new THREE.MeshStandardMaterial({ 
                        color: ROLES[player.role].color,
                        roughness: 0.4,
                        metalness: 0.2,
                        emissive: ROLES[player.role].color,
                        emissiveIntensity: 0.1
                    });
                    const mesh = new THREE.Mesh(geometry, material);
                    mesh.position.set(player.position.x, player.position.y, player.position.z);
                    mesh.castShadow = true;
                    scene.add(mesh);
                    playerMeshes[player.id] = mesh;
                } else {
                    // –ü–õ–ê–í–ù–û–ï –ü–ï–†–ï–ú–ï–©–ï–ù–ò–ï
                    playerMeshes[player.id].position.lerp(
                        new THREE.Vector3(player.position.x, player.position.y, player.position.z),
                        0.3
                    );
                }
            });
        }
        
        function setupConnection(conn) {
            conn.on('open', () => {
                connections[conn.peer] = conn;
                
                conn.send({
                    type: 'player_info',
                    player: {
                        id: myPeerId,
                        name: currentUser.name,
                        role: currentUser.role
                    }
                });
            });
            
            conn.on('data', (data) => {
                handleMultiplayerData(data, conn.peer);
            });
            
            conn.on('close', () => {
                delete connections[conn.peer];
                
                if (playerMeshes[conn.peer]) {
                    scene.remove(playerMeshes[conn.peer]);
                    delete playerMeshes[conn.peer];
                }
            });
        }
        
        function handleMultiplayerData(data, peerId) {
            switch(data.type) {
                case 'player_info':
                    otherPlayers[peerId] = data.player;
                    updatePlayerList();
                    break;
                    
                case 'player_position':
                    if (playerMeshes[peerId]) {
                        playerMeshes[peerId].position.lerp(
                            new THREE.Vector3(data.x, data.y, data.z),
                            0.3
                        );
                    }
                    break;
                    
                case 'chat_message':
                    addChatMessage(data.player + ": " + data.message);
                    break;
                    
                case 'admin_action':
                    if (data.target === myPeerId) {
                        handleAdminAction(data.action);
                    }
                    break;
            }
        }
        
        function sendToAll(data) {
            Object.values(connections).forEach(conn => {
                if (conn.open) {
                    conn.send(data);
                }
            });
        }
        
        function initGameMultiplayer() {
            if (peer && peer.disconnected) {
                peer.reconnect();
            }
        }
        
        // ==================== –ß–ê–¢ ====================
        function sendChat() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (message) {
                addChatMessage(`${currentUser.name}: ${message}`);
                sendToAll({
                    type: 'chat_message',
                    player: currentUser.name,
                    message: message
                });
                input.value = '';
            }
        }
        
        function addChatMessage(text) {
            const messages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-message';
            messageDiv.textContent = text;
            messages.appendChild(messageDiv);
            messages.scrollTop = messages.scrollHeight;
        }
        
        // ==================== –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨ ====================
        function toggleAdminPanel() {
            if (!currentGame) return;
            
            adminPanelVisible = !adminPanelVisible;
            document.getElementById('adminPanel').style.display = adminPanelVisible ? 'block' : 'none';
            
            if (adminPanelVisible) {
                updateAdminPanel();
            }
        }
        
        function updateAdminPanel() {
            const container = document.getElementById('adminPlayersList');
            if (!container) return;
            
            const allPlayers = [
                { id: myPeerId, name: currentUser.name, role: currentUser.role, isCurrent: true },
                ...Object.values(otherPlayers)
            ];
            
            TEST_USERS.forEach(user => {
                if (user.email !== currentUser.email) {
                    allPlayers.push({
                        id: user.id,
                        name: user.name,
                        role: user.role,
                        isTest: true
                    });
                }
            });
            
            container.innerHTML = allPlayers.map(player => {
                const role = ROLES[player.role];
                const canAct = currentUser.role > player.role;
                
                return `
                    <div class="player-item player-${player.role}">
                        <div class="player-info">
                            <div class="player-name">${player.name} ${player.isCurrent ? '(–í—ã)' : ''} ${player.isTest ? '[–¢–µ—Å—Ç]' : ''}</div>
                            <div class="player-role">${role.name}</div>
                        </div>
                        <div class="admin-actions">
                            ${currentUser.role >= 1 && canAct ? '<button class="action-btn mute-btn" onclick="mutePlayer(\'' + player.id + '\')">–ú—É—Ç</button>' : ''}
                            ${currentUser.role >= 2 && canAct ? '<button class="action-btn kick-btn" onclick="kickPlayer(\'' + player.id + '\')">–ö–∏–∫</button>' : ''}
                            ${currentUser.role >= 3 && canAct ? '<button class="action-btn ban-btn" onclick="banPlayer(\'' + player.id + '\')">–ë–∞–Ω</button>' : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function mutePlayer(playerId) {
            showNotification(`–ò–≥—Ä–æ–∫ –∑–∞–º—É—á–µ–Ω`, "warning");
            sendToAll({
                type: 'admin_action',
                target: playerId,
                action: 'mute'
            });
        }
        
        function kickPlayer(playerId) {
            showNotification(`–ò–≥—Ä–æ–∫ –∫–∏–∫–Ω—É—Ç`, "warning");
            sendToAll({
                type: 'admin_action',
                target: playerId,
                action: 'kick'
            });
        }
        
        function banPlayer(playerId) {
            showNotification(`–ò–≥—Ä–æ–∫ –∑–∞–±–∞–Ω–µ–Ω`, "error");
            sendToAll({
                type: 'admin_action',
                target: playerId,
                action: 'ban'
            });
        }
        
        function handleAdminAction(action) {
            switch(action) {
                case 'mute':
                    showNotification("–í—ã –ø–æ–ª—É—á–∏–ª–∏ –º—É—Ç –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞", "warning");
                    break;
                case 'kick':
                    showNotification("–í–∞—Å –∫–∏–∫–Ω—É–ª –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä", "error");
                    setTimeout(() => stopGame(), 2000);
                    break;
                case 'ban':
                    showNotification("–í—ã –∑–∞–±–∞–Ω–µ–Ω—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º", "error");
                    setTimeout(() => {
                        currentUser = null;
                        localStorage.removeItem('stelscity_current_user');
                        location.reload();
                    }, 2000);
                    break;
            }
        }
        
        // ==================== –£–¢–ò–õ–ò–¢–´ ====================
        function showNotification(message, type = "info") {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }
        
        function updatePlayerList() {
            if (adminPanelVisible) {
                updateAdminPanel();
            }
        }
        
        // ==================== –°–û–ë–´–¢–ò–Ø ====================
        window.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && currentGame) {
                stopGame();
            }
            
            if (e.key === 'Tab' && currentGame) {
                e.preventDefault();
                toggleAdminPanel();
            }
            
            if (e.key === 'Enter' && currentGame) {
                const chatInput = document.getElementById('chatInput');
                if (document.activeElement !== chatInput) {
                    chatInput.focus();
                    e.preventDefault();
                }
            }
        });
        
        window.addEventListener('DOMContentLoaded', init);
        
        // –ê–í–¢–û–°–û–•–†–ê–ù–ï–ù–ò–ï
        setInterval(() => {
            if (currentUser) {
                saveUserData();
            }
        }, 30000);
        
        // –û–ß–ò–°–¢–ö–ê –ú–£–õ–¨–¢–ò–ü–õ–ï–ï–†–ê
        setInterval(() => {
            const now = Date.now();
            const allKeys = Object.keys(localStorage);
            for (const key of allKeys) {
                if (key.startsWith('stelscity_multiplayer_')) {
                    try {
                        const data = JSON.parse(localStorage.getItem(key));
                        if (now - data.timestamp > 10000) {
                            localStorage.removeItem(key);
                        }
                    } catch(e) {}
                }
            }
        }, 5000);
    </script>
</body>
</html>

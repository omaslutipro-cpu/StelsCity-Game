<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StelsCity v1.0 - 3D –ò–≥—Ä–∞ –Ω–∞ Three.js</title>
    <meta name="description" content="–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è 3D –∏–≥—Ä–∞ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Ä–µ–∂–∏–º–∞–º–∏: –≤—ã–∂–∏–≤–∞–Ω–∏–µ, –ø–∞—Ä–∫—É—Ä, –±–∏—Ç–≤–∞, —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ">
    <meta name="keywords" content="3D –∏–≥—Ä–∞, Three.js, StelsCity, –æ–Ω–ª–∞–π–Ω –∏–≥—Ä–∞, –±–µ—Å–ø–ª–∞—Ç–Ω–æ">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üéÆ</text></svg>">
    <style>
        /* ===== –°–ë–†–û–° –°–¢–ò–õ–ï–ô ===== */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        /* ===== –û–°–ù–û–í–ù–´–ï –°–¢–ò–õ–ò ===== */
        body { 
            background: linear-gradient(135deg, #0f172a, #1e293b); 
            color: white; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            height: 100vh;
            overflow: hidden;
            user-select: none;
        }
        
        /* ===== –≠–ö–†–ê–ù –ó–ê–ì–†–£–ó–ö–ò ===== */
        #loadingScreen {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: #0f172a;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.5s;
        }
        
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(59, 130, 246, 0.3);
            border-top: 5px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ===== –ú–û–ë–ò–õ–¨–ù–û–ï –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï ===== */
        #mobileWarning {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: linear-gradient(135deg, #0f172a, #1e293b);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 20px;
            text-align: center;
        }
        
        /* ===== –í–ï–†–•–ù–Ø–Ø –ü–ê–ù–ï–õ–¨ ===== */
        .top-bar {
            position: fixed;
            top: 0; left: 0; right: 0;
            height: 60px;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            border-bottom: 2px solid #3b82f6;
            z-index: 100;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #60a5fa;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* ===== –ö–ù–û–ü–ö–ò ===== */
        .ui-btn {
            padding: 8px 16px;
            background: rgba(59, 130, 246, 0.2);
            color: white;
            border: 1px solid rgba(59, 130, 246, 0.4);
            border-radius: 8px;
            cursor: pointer;
            margin: 0 5px;
            font-size: 1rem;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .ui-btn:hover {
            background: rgba(59, 130, 246, 0.4);
            transform: translateY(-2px);
        }
        
        /* ===== –ú–ï–ù–Æ –ò–ì–† ===== */
        .games-menu {
            position: fixed;
            top: 60px; left: 0; right: 0; bottom: 0;
            background: rgba(15, 23, 42, 0.98);
            padding: 30px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 25px;
            overflow-y: auto;
            z-index: 99;
            display: none;
        }
        
        .game-card {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.8), rgba(15, 23, 42, 0.9));
            border-radius: 15px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            text-align: center;
        }
        
        .game-card:hover {
            border-color: #3b82f6;
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(59, 130, 246, 0.3);
        }
        
        .game-preview {
            height: 120px;
            background: linear-gradient(45deg, #3b82f6, #8b5cf6);
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            margin-top: -10px;
        }
        
        /* ===== CANVAS –î–õ–Ø 3D ===== */
        #gameCanvas {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 1;
            display: none;
        }
        
        /* ===== –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø ===== */
        .notification {
            position: fixed;
            top: 70px;
            right: 20px;
            background: rgba(21, 128, 61, 0.95);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            z-index: 102;
            display: none;
            animation: slideIn 0.3s ease;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            max-width: 300px;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(100px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        /* ===== –ü–ê–ù–ï–õ–ò ===== */
        .panel {
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 800px;
            height: 85%;
            background: rgba(15, 23, 42, 0.98);
            border: 2px solid #3b82f6;
            border-radius: 15px;
            padding: 25px;
            z-index: 101;
            display: none;
            box-shadow: 0 25px 60px rgba(0,0,0,0.5);
            overflow: hidden;
        }
        
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(59, 130, 246, 0.3);
        }
        
        /* ===== –ú–ê–ì–ê–ó–ò–ù ===== */
        .shop-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
            overflow-y: auto;
            max-height: calc(100% - 80px);
            padding-right: 10px;
        }
        
        .shop-item {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.7), rgba(15, 23, 42, 0.8));
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .shop-item:hover {
            border-color: #3b82f6;
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.2);
        }
        
        /* ===== –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ ===== */
        @media (max-width: 768px) {
            .games-menu {
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
                padding: 20px;
                gap: 15px;
            }
            
            .top-bar {
                padding: 0 10px;
                height: 50px;
            }
            
            .ui-btn {
                padding: 6px 12px;
                font-size: 0.9rem;
            }
            
            .logo {
                font-size: 1.2rem;
            }
        }
        
        /* ===== –°–ö–†–û–õ–õ–ë–ê–† ===== */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(30, 41, 59, 0.5);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #3b82f6;
            border-radius: 4px;
        }
        
        /* ===== –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –°–¢–ò–õ–ò ===== */
        .hidden { display: none !important; }
        .center-text { text-align: center; }
        .mt-10 { margin-top: 10px; }
        .mt-20 { margin-top: 20px; }
        .text-muted { color: #94a3b8; }
        .text-warning { color: #fbbf24; }
        .text-danger { color: #ef4444; }
    </style>
</head>
<body>
    <!-- –≠–ö–†–ê–ù –ó–ê–ì–†–£–ó–ö–ò -->
    <div id="loadingScreen">
        <div class="loading-spinner"></div>
        <div style="font-size: 1.5rem; margin-bottom: 10px; color: #60a5fa;">StelsCity v1.0</div>
        <div style="color: #94a3b8;">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä–æ–≤–æ–≥–æ –º–∏—Ä–∞...</div>
    </div>

    <!-- –ú–û–ë–ò–õ–¨–ù–û–ï –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï -->
    <div id="mobileWarning">
        <div style="font-size: 4rem; margin-bottom: 20px;">üì±</div>
        <h2 style="color: #ef4444; margin-bottom: 15px;">–ú–æ–±–∏–ª—å–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è</h2>
        <p style="color: #94a3b8; max-width: 500px; line-height: 1.6;">
            StelsCity —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –¥–ª—è –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–≤ –∏ –Ω–æ—É—Ç–±—É–∫–æ–≤.<br>
            –î–ª—è –Ω–∞–∏–ª—É—á—à–µ–≥–æ –∏–≥—Ä–æ–≤–æ–≥–æ –æ–ø—ã—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ü–ö.<br><br>
            –ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.
        </p>
    </div>

    <!-- 3D CANVAS -->
    <canvas id="gameCanvas"></canvas>

    <!-- –í–ï–†–•–ù–Ø–Ø –ü–ê–ù–ï–õ–¨ -->
    <div class="top-bar">
        <div class="logo">
            <span>üéÆ</span>
            <span>StelsCity</span>
        </div>
        
        <div>
            <button class="ui-btn" onclick="showPanel('shopPanel')">
                <span>üõí</span>
                <span>–ú–∞–≥–∞–∑–∏–Ω</span>
            </button>
            <button class="ui-btn" onclick="showGames()">
                <span>üéÆ</span>
                <span>–ò–≥—Ä—ã</span>
            </button>
        </div>
        
        <div>
            <div class="ui-btn">
                <span>üí∞</span>
                <span id="playerCoins">1000</span>
            </div>
        </div>
    </div>

    <!-- –ú–ï–ù–Æ –ò–ì–† -->
    <div class="games-menu" id="gamesMenu">
        <div class="game-card" onclick="startGame('99nights')">
            <div class="game-preview">99</div>
            <h3>99 –ù–æ—á–µ–π</h3>
            <p style="color: #94a3b8; margin-top: 10px;">–í—ã–∂–∏–≤–∞–Ω–∏–µ –≤ –º–∏—Ä–µ –∑–æ–º–±–∏</p>
        </div>
        
        <div class="game-card" onclick="startGame('parkour')">
            <div class="game-preview">üèÉ</div>
            <h3>–≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–π –ø–∞—Ä–∫—É—Ä</h3>
            <p style="color: #94a3b8; margin-top: 10px;">–ü—Ä—ã–≥–∞–π –ø–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º</p>
        </div>
        
        <div class="game-card" onclick="startGame('battle')">
            <div class="game-preview">‚öîÔ∏è</div>
            <h3>–ê—Ä–µ–Ω–∞ –±–∏—Ç–≤</h3>
            <p style="color: #94a3b8; margin-top: 10px;">–°—Ä–∞–∂–∞–π—Å—è —Å –∏–≥—Ä–æ–∫–∞–º–∏</p>
        </div>
        
        <div class="game-card" onclick="startGame('build')">
            <div class="game-preview">üèóÔ∏è</div>
            <h3>–¢–≤–æ—Ä—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º</h3>
            <p style="color: #94a3b8; margin-top: 10px;">–°—Ç—Ä–æ–π —á—Ç–æ —É–≥–æ–¥–Ω–æ</p>
        </div>
        
        <div class="game-card" onclick="showPanel('wardrobePanel')">
            <div class="game-preview">üëï</div>
            <h3>–ì–∞—Ä–¥–µ—Ä–æ–±</h3>
            <p style="color: #94a3b8; margin-top: 10px;">–ù–∞—Å—Ç—Ä–æ–π –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</p>
        </div>
        
        <div class="game-card" onclick="showPanel('editorPanel')">
            <div class="game-preview">üó∫Ô∏è</div>
            <h3>–†–µ–¥–∞–∫—Ç–æ—Ä –∫–∞—Ä—Ç</h3>
            <p style="color: #94a3b8; margin-top: 10px;">–°–æ–∑–¥–∞–π —Å–≤–æ—é –∫–∞—Ä—Ç—É</p>
        </div>
    </div>

    <!-- –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø -->
    <div class="notification" id="notification"></div>

    <!-- –ü–ê–ù–ï–õ–¨ –ú–ê–ì–ê–ó–ò–ù–ê -->
    <div class="panel" id="shopPanel">
        <div class="panel-header">
            <h2>üõí –ú–∞–≥–∞–∑–∏–Ω –ø—Ä–µ–¥–º–µ—Ç–æ–≤</h2>
            <button class="ui-btn danger" onclick="hidePanel('shopPanel')">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
        <div class="shop-items">
            <!-- –¢–æ–≤–∞—Ä—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
        </div>
    </div>

    <!-- –ü–ê–ù–ï–õ–¨ –ì–ê–†–î–ï–†–û–ë–ê -->
    <div class="panel" id="wardrobePanel">
        <div class="panel-header">
            <h2>üëï –ì–∞—Ä–¥–µ—Ä–æ–± –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</h2>
            <button class="ui-btn danger" onclick="hidePanel('wardrobePanel')">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
        <div style="text-align: center;">
            <div style="font-size: 5rem; margin: 20px 0;">üë§</div>
            <h3>–í–∞—à –ø–µ—Ä—Å–æ–Ω–∞–∂</h3>
            <p style="color: #94a3b8;">–í—ã–±–µ—Ä–∏—Ç–µ —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</p>
            
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 30px;">
                <div class="shop-item" onclick="equipItem('head')">
                    <div style="font-size: 2.5rem;">üëí</div>
                    <div style="margin-top: 10px;">–ì–æ–ª–æ–≤–Ω–æ–π —É–±–æ—Ä</div>
                </div>
                <div class="shop-item" onclick="equipItem('torso')">
                    <div style="font-size: 2.5rem;">üëï</div>
                    <div style="margin-top: 10px;">–û–¥–µ–∂–¥–∞</div>
                </div>
                <div class="shop-item" onclick="equipItem('legs')">
                    <div style="font-size: 2.5rem;">üëñ</div>
                    <div style="margin-top: 10px;">–®—Ç–∞–Ω—ã</div>
                </div>
                <div class="shop-item" onclick="equipItem('feet')">
                    <div style="font-size: 2.5rem;">üëü</div>
                    <div style="margin-top: 10px;">–û–±—É–≤—å</div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ü–ê–ù–ï–õ–¨ –†–ï–î–ê–ö–¢–û–†–ê -->
    <div class="panel" id="editorPanel">
        <div class="panel-header">
            <h2>üó∫Ô∏è –†–µ–¥–∞–∫—Ç–æ—Ä –∫–∞—Ä—Ç</h2>
            <button class="ui-btn danger" onclick="hidePanel('editorPanel')">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
        <div style="text-align: center; padding: 50px 20px;">
            <div style="font-size: 4rem; margin-bottom: 20px;">üõ†Ô∏è</div>
            <h2>–†–µ–¥–∞–∫—Ç–æ—Ä –∫–∞—Ä—Ç –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</h2>
            <p style="color: #94a3b8; margin-top: 15px; max-width: 500px; margin-left: auto; margin-right: auto;">
                –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π 3D —Ä–µ–¥–∞–∫—Ç–æ—Ä –∫–∞—Ä—Ç –ø–æ—è–≤–∏—Ç—Å—è –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏.<br>
                –í—ã —Å–º–æ–∂–µ—Ç–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –º–∏—Ä—ã –∏ –¥–µ–ª–∏—Ç—å—Å—è –∏–º–∏ —Å –¥—Ä—É–∑—å—è–º–∏!
            </p>
            <button class="ui-btn" style="margin-top: 30px; padding: 12px 25px;" onclick="showNotification('–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Ä–µ–ª–∏–∑–µ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å!')">
                üîî –£–≤–µ–¥–æ–º–∏—Ç—å –æ —Ä–µ–ª–∏–∑–µ
            </button>
        </div>
    </div>

    <!-- –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨ (–ü–û–ö–ê–ó–´–í–ê–ï–¢–°–Ø –ü–û TAB) -->
    <div class="panel" id="adminPanel" style="max-width: 400px; height: auto; display: none;">
        <div class="panel-header">
            <h2>üë• –ò–≥—Ä–æ–∫–∏ –æ–Ω–ª–∞–π–Ω</h2>
            <div style="color: #94a3b8; font-size: 0.9rem;">–ù–∞–∂–º–∏—Ç–µ TAB –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è</div>
        </div>
        <div id="playerList">
            <!-- –°–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤ -->
        </div>
    </div>

    <script>
        // ========== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ==========
        let gameData = {
            coins: 1000,
            level: 1,
            playerName: "–ò–≥—Ä–æ–∫",
            stats: {
                gamesPlayed: 0,
                totalCoins: 1000,
                playTime: 0
            },
            inventory: []
        };

        let currentGame = null;
        let isMobile = false;
        let gameStartTime = null;

        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
        function init() {
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
            checkMobile();
            
            if (isMobile) {
                document.getElementById('mobileWarning').style.display = 'flex';
                return;
            }
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–π
            loadGameData();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–∞–≥–∞–∑–∏–Ω–∞
            initShop();
            
            // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            setTimeout(() => {
                document.getElementById('loadingScreen').classList.add('hidden');
                document.getElementById('gamesMenu').style.display = 'grid';
                showNotification('StelsCity v1.0 –∑–∞–≥—Ä—É–∂–µ–Ω! –í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É.');
            }, 1500);
            
            // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
            setInterval(saveGameData, 30000);
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∞–≤–∏—à
            setupKeyHandlers();
        }

        // ========== –ú–û–ë–ò–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê ==========
        function checkMobile() {
            const userAgent = navigator.userAgent.toLowerCase();
            const mobileKeywords = ['android', 'iphone', 'ipad', 'mobile'];
            isMobile = mobileKeywords.some(keyword => userAgent.includes(keyword));
            
            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ —Ä–∞–∑–º–µ—Ä—É —ç–∫—Ä–∞–Ω–∞
            if (!isMobile && window.innerWidth <= 768) {
                isMobile = true;
            }
        }

        // ========== –°–û–•–†–ê–ù–ï–ù–ò–ï ==========
        function saveGameData() {
            try {
                localStorage.setItem('stelscity_save', JSON.stringify(gameData));
            } catch (e) {
                console.log('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
            }
        }

        function loadGameData() {
            try {
                const saved = localStorage.getItem('stelscity_save');
                if (saved) {
                    gameData = JSON.parse(saved);
                    updateUI();
                }
            } catch (e) {
                console.log('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
            }
        }

        // ========== –ò–ù–¢–ï–†–§–ï–ô–° ==========
        function updateUI() {
            document.getElementById('playerCoins').textContent = gameData.coins;
        }

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.display = 'block';
            notification.style.background = type === 'error' 
                ? 'rgba(239, 68, 68, 0.95)' 
                : 'rgba(21, 128, 61, 0.95)';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        function showPanel(panelId) {
            hideAllPanels();
            document.getElementById(panelId).style.display = 'block';
            
            if (panelId === 'shopPanel') {
                initShop();
            }
        }

        function hidePanel(panelId) {
            document.getElementById(panelId).style.display = 'none';
        }

        function hideAllPanels() {
            document.querySelectorAll('.panel').forEach(panel => {
                panel.style.display = 'none';
            });
            document.getElementById('gamesMenu').style.display = 'none';
        }

        function showGames() {
            hideAllPanels();
            document.getElementById('gamesMenu').style.display = 'grid';
        }

        // ========== –ò–ì–†–´ ==========
        function startGame(gameType) {
            if (isMobile) return;
            
            currentGame = gameType;
            hideAllPanels();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            gameData.stats.gamesPlayed++;
            gameData.coins += 50; // –ù–∞–≥—Ä–∞–¥–∞ –∑–∞ –∑–∞–ø—É—Å–∫ –∏–≥—Ä—ã
            updateUI();
            saveGameData();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º canvas
            document.getElementById('gameCanvas').style.display = 'block';
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º 3D —Å—Ü–µ–Ω—É
            init3DScene(gameType);
            
            showNotification(`–ò–≥—Ä–∞ "${getGameName(gameType)}" –Ω–∞—á–∞–ª–∞—Å—å!`);
        }

        function getGameName(type) {
            const names = {
                '99nights': '99 –ù–æ—á–µ–π',
                'parkour': '–ü–∞—Ä–∫—É—Ä',
                'battle': '–ë–∏—Ç–≤–∞',
                'build': '–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ'
            };
            return names[type] || '–ò–≥—Ä–∞';
        }

        // ========== 3D –°–¶–ï–ù–ê ==========
        function init3DScene(gameType) {
            const canvas = document.getElementById('gameCanvas');
            
            // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç—É—é 3D —Å—Ü–µ–Ω—É
            const scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0f172a);
            
            const camera = new THREE.PerspectiveCamera(
                75, 
                window.innerWidth / window.innerHeight, 
                0.1, 
                1000
            );
            camera.position.z = 5;
            
            const renderer = new THREE.WebGLRenderer({ 
                canvas, 
                antialias: true 
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            
            // –û—Å–≤–µ—â–µ–Ω–∏–µ
            const light = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(light);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(10, 10, 5);
            scene.add(directionalLight);
            
            // –û–±—ä–µ–∫—Ç—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –∏–≥—Ä—ã
            let objects = [];
            
            if (gameType === '99nights') {
                // –ó–æ–º–±–∏-–∫—É–±
                const geometry = new THREE.BoxGeometry(1, 2, 1);
                const material = new THREE.MeshPhongMaterial({ color: 0x00ff00 });
                const cube = new THREE.Mesh(geometry, material);
                scene.add(cube);
                objects.push(cube);
            } else if (gameType === 'parkour') {
                // –ü–ª–∞—Ç—Ñ–æ—Ä–º—ã
                for (let i = 0; i < 5; i++) {
                    const geometry = new THREE.BoxGeometry(2, 0.5, 2);
                    const material = new THREE.MeshPhongMaterial({ color: 0x3b82f6 });
                    const platform = new THREE.Mesh(geometry, material);
                    platform.position.set(
                        Math.random() * 10 - 5,
                        i * 2,
                        Math.random() * 10 - 5
                    );
                    scene.add(platform);
                    objects.push(platform);
                }
            }
            
            // –ê–Ω–∏–º–∞—Ü–∏—è
            function animate() {
                requestAnimationFrame(animate);
                
                objects.forEach(obj => {
                    obj.rotation.y += 0.01;
                });
                
                renderer.render(scene, camera);
            }
            
            animate();
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
        }

        // ========== –ú–ê–ì–ê–ó–ò–ù ==========
        function initShop() {
            const shopItems = [
                { id: 1, name: '–ó–æ–ª–æ—Ç–∞—è –∫–æ—Ä–æ–Ω–∞', price: 500, icon: 'üëë', desc: '–ü–æ–≤—ã—à–∞–µ—Ç —É–≤–∞–∂–µ–Ω–∏–µ' },
                { id: 2, name: '–ö—Ä—ã–ª—å—è –∞–Ω–≥–µ–ª–∞', price: 300, icon: 'üëº', desc: '–õ–µ—Ç–∞–π—Ç–µ –≤—ã—à–µ' },
                { id: 3, name: '–õ–∞–∑–µ—Ä–Ω—ã–π –º–µ—á', price: 250, icon: '‚öîÔ∏è', desc: '+20 –∫ —Å–∏–ª–µ' },
                { id: 4, name: '–í–æ–ª—à–µ–±–Ω—ã–π –ø–æ—Å–æ—Ö', price: 400, icon: 'üîÆ', desc: '–ú–∞–≥–∏—á–µ—Å–∫–∏–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏' },
                { id: 5, name: '–†—é–∫–∑–∞–∫', price: 150, icon: 'üéí', desc: '–ë–æ–ª—å—à–µ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è' },
                { id: 6, name: '–ó–∞—â–∏—Ç–Ω—ã–π —â–∏—Ç', price: 350, icon: 'üõ°Ô∏è', desc: '+50 –∫ –∑–∞—â–∏—Ç–µ' }
            ];
            
            const container = document.querySelector('.shop-items');
            if (!container) return;
            
            container.innerHTML = shopItems.map(item => `
                <div class="shop-item" onclick="buyItem(${item.id}, ${item.price})">
                    <div style="font-size: 2.5rem;">${item.icon}</div>
                    <h4 style="margin: 15px 0 5px;">${item.name}</h4>
                    <p style="color: #94a3b8; font-size: 0.9rem; margin-bottom: 10px;">${item.desc}</p>
                    <div style="color: #fbbf24; font-weight: bold; font-size: 1.2rem;">
                        ${item.price} üí∞
                    </div>
                </div>
            `).join('');
        }

        function buyItem(itemId, price) {
            if (gameData.coins >= price) {
                gameData.coins -= price;
                gameData.inventory.push(itemId);
                updateUI();
                saveGameData();
                showNotification(`–ö—É–ø–ª–µ–Ω–æ! –û—Å—Ç–∞–ª–æ—Å—å: ${gameData.coins} üí∞`);
            } else {
                showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!', 'error');
            }
        }

        function equipItem(slot) {
            showNotification(`–ù–∞–¥–µ—Ç–æ: ${slot}`);
        }

        // ========== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –ö–õ–ê–í–ò–® ==========
        function setupKeyHandlers() {
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    e.preventDefault();
                    if (currentGame) {
                        currentGame = null;
                        document.getElementById('gameCanvas').style.display = 'none';
                        showGames();
                    } else {
                        hideAllPanels();
                    }
                }
                
                if (e.key === 'Tab') {
                    e.preventDefault();
                    const adminPanel = document.getElementById('adminPanel');
                    adminPanel.style.display = adminPanel.style.display === 'block' ? 'none' : 'block';
                }
            });
        }

        // ========== –ó–ê–ü–£–°–ö ==========
        window.addEventListener('DOMContentLoaded', init);
        window.addEventListener('beforeunload', saveGameData);

        // –ó–∞–≥—Ä—É–∑–∫–∞ Three.js
        const threeScript = document.createElement('script');
        threeScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js';
        threeScript.onload = () => {
            console.log('Three.js –∑–∞–≥—Ä—É–∂–µ–Ω');
        };
        document.head.appendChild(threeScript);
    </script>
</body>
</html>

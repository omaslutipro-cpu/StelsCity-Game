<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StelsCity v1.0</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: linear-gradient(135deg, #0f172a, #1e293b); 
            color: white; 
            font-family: Arial, sans-serif;
            height: 100vh;
            overflow: hidden;
        }
        
        /* –ó–∞–≥—Ä—É–∑–∫–∞ */
        #loadingScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0f172a;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        #loadingScreen.hidden {
            display: none;
        }
        
        /* –ë–∞–Ω–Ω–µ—Ä –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
        #mobileWarning {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0f172a, #1e293b);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 20px;
            text-align: center;
        }
        
        .warning-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            color: #ef4444;
        }
        
        .warning-title {
            font-size: 2rem;
            margin-bottom: 15px;
            color: #ef4444;
        }
        
        .warning-text {
            font-size: 1.2rem;
            color: #94a3b8;
            max-width: 500px;
            line-height: 1.5;
        }
        
        /* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å */
        .top-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 50px;
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 15px;
            border-bottom: 2px solid #3b82f6;
            z-index: 100;
        }
        
        .logo {
            font-size: 1.2rem;
            font-weight: bold;
            color: #60a5fa;
        }
        
        .ui-btn {
            padding: 6px 12px;
            background: rgba(59, 130, 246, 0.2);
            color: white;
            border: 1px solid rgba(59, 130, 246, 0.4);
            border-radius: 6px;
            cursor: pointer;
            margin: 0 3px;
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }
        
        .ui-btn:hover {
            background: rgba(59, 130, 246, 0.4);
        }
        
        .ui-btn.danger {
            background: rgba(239, 68, 68, 0.2);
            border-color: rgba(239, 68, 68, 0.4);
        }
        
        .ui-btn.danger:hover {
            background: rgba(239, 68, 68, 0.4);
        }
        
        /* –ò–≥—Ä–æ–≤–æ–µ –º–µ–Ω—é */
        .games-menu {
            position: fixed;
            top: 50px;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            overflow-y: auto;
            z-index: 99;
        }
        
        .game-card {
            background: rgba(30, 41, 59, 0.7);
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: 0.3s;
            border: 2px solid transparent;
        }
        
        .game-card:hover {
            border-color: #3b82f6;
            transform: translateY(-5px);
        }
        
        .game-preview {
            height: 100px;
            background: linear-gradient(45deg, #3b82f6, #8b5cf6);
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
        }
        
        /* –ü–∞–Ω–µ–ª–∏ */
        .panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 700px;
            height: 80%;
            background: rgba(15, 23, 42, 0.98);
            border: 2px solid #3b82f6;
            border-radius: 12px;
            padding: 20px;
            z-index: 101;
            display: none;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            overflow: hidden;
        }
        
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(59, 130, 246, 0.3);
        }
        
        .close-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .close-btn:hover {
            background: #dc2626;
        }
        
        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ */
        .notification {
            position: fixed;
            top: 60px;
            right: 20px;
            background: rgba(21, 128, 61, 0.9);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            z-index: 102;
            display: none;
            animation: slideIn 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        /* 3D Canvas */
        #gameCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            display: none;
        }
        
        /* –ú–∞–≥–∞–∑–∏–Ω */
        .shop-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            overflow-y: auto;
            max-height: calc(100% - 60px);
            padding-right: 10px;
        }
        
        .shop-item {
            background: rgba(30, 41, 59, 0.6);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .shop-item:hover {
            background: rgba(59, 130, 246, 0.3);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.2);
        }
        
        /* –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è */
        .admin-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(239, 68, 68, 0.9);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            z-index: 98;
            display: none;
            backdrop-filter: blur(10px);
            border: 2px solid #ef4444;
            max-width: 300px;
            max-height: 400px;
            overflow: hidden;
        }
        
        .admin-panel h3 {
            margin-bottom: 10px;
            color: #fecaca;
            font-size: 1rem;
        }
        
        .player-list {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
            padding-right: 5px;
        }
        
        .player-list::-webkit-scrollbar {
            width: 5px;
        }
        
        .player-list::-webkit-scrollbar-track {
            background: rgba(30, 41, 59, 0.5);
            border-radius: 3px;
        }
        
        .player-list::-webkit-scrollbar-thumb {
            background: rgba(59, 130, 246, 0.5);
            border-radius: 3px;
        }
        
        .player-item {
            padding: 8px 10px;
            background: rgba(30, 41, 59, 0.6);
            margin: 5px 0;
            border-radius: 4px;
            border-left: 3px solid #3b82f6;
            font-size: 0.9rem;
        }
        
        .player-role {
            font-size: 0.7rem;
            color: #94a3b8;
            margin-top: 2px;
        }
        
        /* –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–æ–º */
        .account-panel {
            position: fixed;
            top: 60px;
            right: 20px;
            background: rgba(15, 23, 42, 0.98);
            border: 2px solid #3b82f6;
            border-radius: 12px;
            padding: 20px;
            z-index: 103;
            display: none;
            min-width: 250px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        
        .account-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(59, 130, 246, 0.3);
        }
        
        .account-avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(45deg, #3b82f6, #8b5cf6);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-right: 15px;
        }
        
        .account-info h3 {
            font-size: 1.2rem;
            margin-bottom: 5px;
        }
        
        .account-info p {
            color: #94a3b8;
            font-size: 0.9rem;
        }
        
        .account-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .account-btn {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(59, 130, 246, 0.3);
            color: white;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .account-btn:hover {
            background: rgba(59, 130, 246, 0.3);
            transform: translateX(5px);
        }
        
        .account-btn.danger {
            background: rgba(239, 68, 68, 0.2);
            border-color: rgba(239, 68, 68, 0.4);
        }
        
        .account-btn.danger:hover {
            background: rgba(239, 68, 68, 0.4);
        }
        
        .btn-icon {
            font-size: 1.2rem;
        }
        
        /* –î–∏–∞–ª–æ–≥–æ–≤–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è */
        .confirm-dialog {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(15, 23, 42, 0.98);
            border: 2px solid #ef4444;
            border-radius: 12px;
            padding: 30px;
            z-index: 104;
            display: none;
            min-width: 300px;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 15px 40px rgba(239, 68, 68, 0.3);
        }
        
        .confirm-icon {
            font-size: 3rem;
            color: #ef4444;
            margin-bottom: 15px;
        }
        
        .confirm-title {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: #fecaca;
        }
        
        .confirm-message {
            color: #94a3b8;
            margin-bottom: 25px;
            line-height: 1.5;
        }
        
        .confirm-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        .confirm-btn {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
            min-width: 100px;
        }
        
        .confirm-cancel {
            background: rgba(59, 130, 246, 0.2);
            color: white;
            border: 1px solid rgba(59, 130, 246, 0.4);
        }
        
        .confirm-cancel:hover {
            background: rgba(59, 130, 246, 0.4);
        }
        
        .confirm-danger {
            background: rgba(239, 68, 68, 0.8);
            color: white;
            border: 1px solid #ef4444;
        }
        
        .confirm-danger:hover {
            background: #ef4444;
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .games-menu {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            .panel {
                width: 95%;
                height: 90%;
            }
            .shop-items {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
            .admin-panel {
                left: 20px;
                right: 20px;
                max-width: none;
            }
            .account-panel {
                left: 20px;
                right: 20px;
                min-width: auto;
            }
        }
        
        /* –§–∏–∫—Å –¥–ª—è Three.js —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ */
        .threejs-fix {
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
        }
        
        /* –ù–æ–≤–∞—è —Ñ–∏—á–∞: –°–µ–∫—Ä–µ—Ç–Ω–∞—è –∫–Ω–æ–ø–∫–∞ */
        .secret-btn {
            position: fixed;
            bottom: 20px;
            left: 20px;
            width: 40px;
            height: 40px;
            background: rgba(139, 92, 246, 0.3);
            border: 2px solid #8b5cf6;
            border-radius: 50%;
            cursor: pointer;
            z-index: 50;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.3s;
            opacity: 0.3;
        }
        
        .secret-btn:hover {
            opacity: 1;
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.5);
        }
        
        /* –°–µ–∫—Ä–µ—Ç–Ω–∞—è –ø–∞–Ω–µ–ª—å */
        .secret-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(15, 23, 42, 0.95);
            border: 2px solid #8b5cf6;
            border-radius: 15px;
            padding: 30px;
            z-index: 105;
            display: none;
            min-width: 300px;
            text-align: center;
            box-shadow: 0 0 50px rgba(139, 92, 246, 0.3);
        }
        
        .easter-egg {
            font-size: 4rem;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
    </style>
</head>
<body>
    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ -->
    <div id="loadingScreen">
        <div style="font-size: 3rem; margin-bottom: 20px;">üéÆ</div>
        <div style="font-size: 1.2rem; margin-bottom: 10px;">StelsCity v1.0</div>
        <div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>

    <!-- –ë–∞–Ω–Ω–µ—Ä –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ -->
    <div id="mobileWarning">
        <div class="warning-icon">üì±</div>
        <div class="warning-title">–ú–æ–±–∏–ª—å–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è</div>
        <div class="warning-text">
            StelsCity v1.0 —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –¥–ª—è –ü–ö.<br>
            –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–ø—å—é—Ç–µ—Ä –∏–ª–∏ –Ω–æ—É—Ç–±—É–∫ –¥–ª—è –∏–≥—Ä—ã.<br><br>
            –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –≤ –±—É–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏—è—Ö.
        </div>
        <div style="margin-top: 30px; color: #64748b; font-size: 0.9rem;">
            –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: <span id="deviceType"></span>
        </div>
    </div>

    <!-- –°–µ–∫—Ä–µ—Ç–Ω–∞—è –∫–Ω–æ–ø–∫–∞ -->
    <div class="secret-btn" onclick="showSecretPanel()">?</div>

    <!-- –°–µ–∫—Ä–µ—Ç–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
    <div class="secret-panel" id="secretPanel">
        <div class="easter-egg">üéâ</div>
        <h2 style="color: #8b5cf6; margin-bottom: 15px;">–°–µ–∫—Ä–µ—Ç–Ω–∞—è –Ω–∞—Ö–æ–¥–∫–∞!</h2>
        <p style="color: #94a3b8; margin-bottom: 20px;">
            –¢—ã –Ω–∞—à–µ–ª —Å–µ–∫—Ä–µ—Ç–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é!<br>
            –í –∫–∞—á–µ—Å—Ç–≤–µ –Ω–∞–≥—Ä–∞–¥—ã –ø–æ–ª—É—á–∞–µ—à—å:<br>
            <span style="color: #fbbf24; font-size: 1.5rem;">+500 üí∞</span>
        </p>
        <button class="ui-btn" onclick="claimSecretReward()" style="background: rgba(139, 92, 246, 0.3); border-color: #8b5cf6;">
            –ó–∞–±—Ä–∞—Ç—å –Ω–∞–≥—Ä–∞–¥—É
        </button>
        <p style="margin-top: 20px; color: #64748b; font-size: 0.8rem;">
            –°–µ–∫—Ä–µ—Ç –Ω–∞–π–¥–µ–Ω: <span id="secretCounter">0</span> —Ä–∞–∑
        </p>
    </div>

    <!-- 3D Canvas -->
    <canvas id="gameCanvas" class="threejs-fix"></canvas>

    <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å -->
    <div class="top-bar">
        <div class="logo">üéÆ StelsCity</div>
        <div>
            <button class="ui-btn" onclick="showPanel('wardrobePanel')">üëï</button>
            <button class="ui-btn" onclick="showPanel('shopPanel')">üõí</button>
            <button class="ui-btn" onclick="showPanel('editorPanel')">üó∫Ô∏è</button>
            <button class="ui-btn" onclick="showGames()">üéÆ</button>
        </div>
        <div>
            <div class="ui-btn">üí∞ <span id="playerCoins">1000</span></div>
            <button class="ui-btn" onclick="toggleAccountPanel()">üë§</button>
        </div>
    </div>

    <!-- –ò–≥—Ä–æ–≤–æ–µ –º–µ–Ω—é -->
    <div class="games-menu" id="gamesMenu" style="display: none;">
        <div class="game-card" onclick="startGame('99nights')">
            <div class="game-preview">99</div>
            <h3>99 –ù–æ—á–µ–π</h3>
            <p>3D –≤—ã–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ—Ç–∏–≤ –∑–æ–º–±–∏</p>
        </div>
        <div class="game-card" onclick="startGame('parkour')">
            <div class="game-preview">üèÉ</div>
            <h3>–ü–∞—Ä–∫—É—Ä</h3>
            <p>3D –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ—Ä —Å –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è–º–∏</p>
        </div>
        <div class="game-card" onclick="startGame('battle')">
            <div class="game-preview">‚öîÔ∏è</div>
            <h3>–ë–∏—Ç–≤–∞</h3>
            <p>3D —Å—Ä–∞–∂–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏–º–∏ –∏–≥—Ä–æ–∫–∞–º–∏</p>
        </div>
        <div class="game-card" onclick="startGame('build')">
            <div class="game-preview">üèóÔ∏è</div>
            <h3>–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ</h3>
            <p>3D —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ –∏ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ</p>
        </div>
    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ -->
    <div class="notification" id="notification"></div>

    <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–æ–º -->
    <div class="account-panel" id="accountPanel">
        <div class="account-header">
            <div class="account-avatar">üë§</div>
            <div class="account-info">
                <h3 id="accountName">–ò–≥—Ä–æ–∫</h3>
                <p id="accountStatus">–£—Ä–æ–≤–µ–Ω—å 1 ‚Ä¢ 1000üí∞</p>
            </div>
        </div>
        <div class="account-actions">
            <button class="account-btn" onclick="showStats()">
                <span class="btn-icon">üìä</span>
                <span>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span>
            </button>
            <button class="account-btn" onclick="logout()">
                <span class="btn-icon">üö™</span>
                <span>–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞</span>
            </button>
            <button class="account-btn danger" onclick="showDeleteConfirm()">
                <span class="btn-icon">üóëÔ∏è</span>
                <span>–£–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç</span>
            </button>
        </div>
    </div>

    <!-- –î–∏–∞–ª–æ–≥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è -->
    <div class="confirm-dialog" id="deleteConfirm">
        <div class="confirm-icon">‚ö†Ô∏è</div>
        <div class="confirm-title">–£–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞</div>
        <div class="confirm-message">
            –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç?<br>
            –í—Å–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –±–µ–∑–≤–æ–∑–≤—Ä–∞—Ç–Ω–æ, –≤–∫–ª—é—á–∞—è:<br>
            ‚Ä¢ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∏ —É—Ä–æ–≤–µ–Ω—å<br>
            ‚Ä¢ –ò–≥—Ä–æ–≤—É—é –≤–∞–ª—é—Ç—É<br>
            ‚Ä¢ –ö—É–ø–ª–µ–Ω–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã<br>
            <br>
            –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!
        </div>
        <div class="confirm-buttons">
            <button class="confirm-btn confirm-cancel" onclick="hideDeleteConfirm()">–û—Ç–º–µ–Ω–∞</button>
            <button class="confirm-btn confirm-danger" onclick="deleteAccount()">–£–¥–∞–ª–∏—Ç—å</button>
        </div>
    </div>

    <!-- –ü–∞–Ω–µ–ª—å –≥–∞—Ä–¥–µ—Ä–æ–±–∞ -->
    <div class="panel" id="wardrobePanel">
        <div class="panel-header">
            <h2>üëï –ì–∞—Ä–¥–µ—Ä–æ–±</h2>
            <button class="close-btn" onclick="hidePanel('wardrobePanel')">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
        <div>
            <div style="text-align: center; margin-bottom: 20px;">
                <div style="font-size: 4rem;">üë§</div>
                <div>–í–∞—à –ø–µ—Ä—Å–æ–Ω–∞–∂</div>
            </div>
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                <div class="shop-item" onclick="equipItem('head')">
                    <div style="font-size: 2rem;">üëí</div>
                    <div>–ì–æ–ª–æ–≤–∞</div>
                </div>
                <div class="shop-item" onclick="equipItem('torso')">
                    <div style="font-size: 2rem;">üëï</div>
                    <div>–¢–æ—Ä—Å</div>
                </div>
                <div class="shop-item" onclick="equipItem('legs')">
                    <div style="font-size: 2rem;">üëñ</div>
                    <div>–ù–æ–≥–∏</div>
                </div>
                <div class="shop-item" onclick="equipItem('feet')">
                    <div style="font-size: 2rem;">üëü</div>
                    <div>–û–±—É–≤—å</div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ü–∞–Ω–µ–ª—å –º–∞–≥–∞–∑–∏–Ω–∞ -->
    <div class="panel" id="shopPanel">
        <div class="panel-header">
            <h2>üõí –ú–∞–≥–∞–∑–∏–Ω</h2>
            <button class="close-btn" onclick="hidePanel('shopPanel')">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
        <div class="shop-items" id="shopItems">
            <!-- –¢–æ–≤–∞—Ä—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
    </div>

    <!-- –ü–∞–Ω–µ–ª—å —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ -->
    <div class="panel" id="editorPanel">
        <div class="panel-header">
            <h2>üó∫Ô∏è –†–µ–¥–∞–∫—Ç–æ—Ä –∫–∞—Ä—Ç</h2>
            <button class="close-btn" onclick="hidePanel('editorPanel')">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
        <div style="text-align: center; padding: 40px;">
            <div style="font-size: 3rem; margin-bottom: 20px;">üõ†Ô∏è</div>
            <h3>–†–µ–¥–∞–∫—Ç–æ—Ä –∫–∞—Ä—Ç –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</h3>
            <p style="color: #94a3b8; margin-top: 10px;">–°–∫–æ—Ä–æ –ø–æ—è–≤–∏—Ç—Å—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π 3D —Ä–µ–¥–∞–∫—Ç–æ—Ä</p>
        </div>
    </div>

    <!-- –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <div class="admin-panel" id="adminPanel">
        <h3>üë• –ò–≥—Ä–æ–∫–∏ –æ–Ω–ª–∞–π–Ω <span style="font-size: 0.7rem; color: #fecaca;">(TAB)</span></h3>
        <div class="player-list" id="playerList">
            <!-- –ò–≥—Ä–æ–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
        <div style="margin-top: 10px; font-size: 0.7rem; color: #fecaca;">
            –í–∞—à–∞ —Ä–æ–ª—å: <span id="currentRole">–ò–≥—Ä–æ–∫</span>
        </div>
    </div>

<script>
// üîê –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ
function encrypt(data) {
    let result = '';
    for (let i = 0; i < data.length; i++) {
        result += String.fromCharCode(data.charCodeAt(i) ^ 42);
    }
    return btoa(result);
}

function decrypt(data) {
    try {
        const decoded = atob(data);
        let result = '';
        for (let i = 0; i < decoded.length; i++) {
            result += String.fromCharCode(decoded.charCodeAt(i) ^ 42);
        }
        return result;
    } catch {
        return null;
    }
}

// üéÆ –°–∏—Å—Ç–µ–º–∞
let gameData = {
    coins: 1000,
    level: 1,
    items: [],
    playerRole: 0, // 0-–∏–≥—Ä–æ–∫, 1-–º–æ–¥–µ—Ä–∞—Ç–æ—Ä, 2-–∞–¥–º–∏–Ω, 3-–≥–ª–∞–≤–Ω—ã–π –∞–¥–º–∏–Ω
    playerName: "–ò–≥—Ä–æ–∫",
    stats: {
        gamesPlayed: 0,
        totalCoinsEarned: 0,
        itemsBought: 0,
        totalPlayTime: 0
    },
    secretsFound: 0, // –ù–æ–≤–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤
    lastSecretTime: 0 // –ö–æ–≥–¥–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑ –Ω–∞—Ö–æ–¥–∏–ª–∏ —Å–µ–∫—Ä–µ—Ç
};

let scene, camera, renderer, cube;
let currentGame = null;
let animationId = null;
let isTabPressed = false;
let adminPanelVisible = false;
let players = [];
let hitboxes = [];
let isMobileDevice = false;
let accountPanelVisible = false;
let gameStartTime = null;

// üì¶ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
function init() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–æ–±–∏–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
    checkMobileDevice();
    
    if (isMobileDevice) {
        document.getElementById('mobileWarning').style.display = 'flex';
        document.getElementById('deviceType').textContent = getDeviceType();
        return; // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
    }
    
    // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
    setTimeout(() => {
        document.getElementById('loadingScreen').classList.add('hidden');
        loadGameData();
        updateAccountInfo();
        createTestPlayers();
        updateRoleDisplay();
        updateSecretCounter();
        showNotification('StelsCity v1.0 –∑–∞–≥—Ä—É–∂–µ–Ω! –ù–∞–∂–º–∏—Ç–µ TAB –≤ –∏–≥—Ä–µ –¥–ª—è –ø–∞–Ω–µ–ª–∏ –∏–≥—Ä–æ–∫–æ–≤');
        
        // –°—Ç–∞—Ä—Ç –æ—Ç—Å—á–µ—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏ –∏–≥—Ä—ã
        gameStartTime = Date.now();
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º —Ñ–æ–Ω–æ–≤—É—é –º—É–∑—ã–∫—É (—Ç–∏—Ö–æ, —á—Ç–æ–±—ã –Ω–µ –º–µ—à–∞–ª–∞)
        playBackgroundMusic();
    }, 1000);
}

// üì± –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–±–∏–ª—å–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
function checkMobileDevice() {
    const userAgent = navigator.userAgent.toLowerCase();
    const mobileKeywords = [
        'android', 'webos', 'iphone', 'ipad', 'ipod', 'blackberry', 
        'windows phone', 'mobile', 'tablet', 'kindle', 'silk'
    ];
    
    isMobileDevice = mobileKeywords.some(keyword => userAgent.includes(keyword));
    
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ —Ä–∞–∑–º–µ—Ä—É —ç–∫—Ä–∞–Ω–∞
    if (!isMobileDevice && window.innerWidth <= 768 && window.innerHeight <= 1024) {
        isMobileDevice = true;
    }
}

function getDeviceType() {
    const ua = navigator.userAgent;
    if (/android/i.test(ua)) return 'Android';
    if (/iPad|iPhone|iPod/.test(ua)) return 'iOS';
    if (/tablet|ipad|playbook|silk/i.test(ua)) return '–ü–ª–∞–Ω—à–µ—Ç';
    if (/mobile/i.test(ua)) return '–ú–æ–±–∏–ª—å–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω';
    return '–ú–æ–±–∏–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ';
}

// üéµ –§–æ–Ω–æ–≤–∞—è –º—É–∑—ã–∫–∞
function playBackgroundMusic() {
    // –°–æ–∑–¥–∞–µ–º —Ç–∏—Ö—É—é —Ñ–æ–Ω–æ–≤—É—é –º—É–∑—ã–∫—É —Å –ø–æ–º–æ—â—å—é Web Audio API
    try {
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∑–≤—É–∫ (—Ç–∏—Ö–∏–π, –Ω–∏–∑–∫–∞—è —á–∞—Å—Ç–æ—Ç–∞)
        gainNode.gain.value = 0.02; // –û—á–µ–Ω—å —Ç–∏—Ö–æ
        oscillator.frequency.value = 220; // –ù–∏–∑–∫–∞—è —á–∞—Å—Ç–æ—Ç–∞
        oscillator.type = 'sine';
        
        // –ü–ª–∞–≤–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤—ã—Å–æ—Ç—ã —Ç–æ–Ω–∞ –¥–ª—è –∞—Ç–º–æ—Å—Ñ–µ—Ä–Ω–æ—Å—Ç–∏
        setInterval(() => {
            oscillator.frequency.value = 200 + Math.random() * 100;
        }, 3000);
        
        oscillator.start();
    } catch (e) {
        console.log('–ê—É–¥–∏–æ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
    }
}

// üîê –°–µ–∫—Ä–µ—Ç–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
function showSecretPanel() {
    const now = Date.now();
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–Ω–æ –ª–∏ —Å–Ω–æ–≤–∞ –ø–æ–ª—É—á–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É (—Ä–∞–∑ –≤ 5 –º–∏–Ω—É—Ç)
    if (now - gameData.lastSecretTime < 300000) {
        const remaining = Math.ceil((300000 - (now - gameData.lastSecretTime)) / 60000);
        showNotification(`–°–µ–∫—Ä–µ—Ç –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –Ω–∞–π—Ç–∏ —á–µ—Ä–µ–∑ ${remaining} –º–∏–Ω`, 'error');
        return;
    }
    
    document.getElementById('secretPanel').style.display = 'block';
}

function claimSecretReward() {
    const now = Date.now();
    gameData.coins += 500;
    gameData.secretsFound++;
    gameData.lastSecretTime = now;
    
    updateUI();
    updateSecretCounter();
    saveGameData();
    
    document.getElementById('secretPanel').style.display = 'none';
    showNotification(`üéâ +500 –º–æ–Ω–µ—Ç! –ù–∞–π–¥–µ–Ω–æ —Å–µ–∫—Ä–µ—Ç–æ–≤: ${gameData.secretsFound}`);
    
    // –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç
    createCoinEffect();
}

function createCoinEffect() {
    const effect = document.createElement('div');
    effect.style.position = 'fixed';
    effect.style.top = '50%';
    effect.style.left = '50%';
    effect.style.fontSize = '3rem';
    effect.style.color = '#fbbf24';
    effect.style.zIndex = '9999';
    effect.style.pointerEvents = 'none';
    effect.textContent = 'üí∞';
    document.body.appendChild(effect);
    
    // –ê–Ω–∏–º–∞—Ü–∏—è
    let opacity = 1;
    let y = 0;
    const interval = setInterval(() => {
        opacity -= 0.05;
        y += 5;
        effect.style.opacity = opacity;
        effect.style.transform = `translate(-50%, -50%) translateY(-${y}px)`;
        
        if (opacity <= 0) {
            clearInterval(interval);
            document.body.removeChild(effect);
        }
    }, 50);
}

function updateSecretCounter() {
    document.getElementById('secretCounter').textContent = gameData.secretsFound;
}

// üìÅ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
function saveGameData() {
    try {
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏–≥—Ä–æ–≤–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
        if (gameStartTime) {
            const playTime = Date.now() - gameStartTime;
            gameData.stats.totalPlayTime += playTime;
            gameStartTime = Date.now();
        }
        
        const data = JSON.stringify(gameData);
        localStorage.setItem('stels_save', encrypt(data));
    } catch(e) {
        console.log('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
    }
}

function loadGameData() {
    try {
        const saved = localStorage.getItem('stels_save');
        if (saved) {
            const decrypted = decrypt(saved);
            if (decrypted) {
                gameData = JSON.parse(decrypted);
                updateUI();
                updateSecretCounter();
            }
        }
    } catch(e) {
        console.log('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏');
    }
}

function updateUI() {
    document.getElementById('playerCoins').textContent = gameData.coins;
}

function updateAccountInfo() {
    document.getElementById('accountName').textContent = gameData.playerName;
    document.getElementById('accountStatus').textContent = `–£—Ä–æ–≤–µ–Ω—å ${gameData.level} ‚Ä¢ ${gameData.coins}üí∞`;
}

function updateRoleDisplay() {
    const roleNames = ['–ò–≥—Ä–æ–∫', '–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä', '–ê–¥–º–∏–Ω', '–ì–ª–∞–≤–Ω—ã–π –∞–¥–º–∏–Ω'];
    document.getElementById('currentRole').textContent = roleNames[gameData.playerRole];
}

// üë§ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–æ–º
function toggleAccountPanel() {
    if (isMobileDevice) return;
    
    accountPanelVisible = !accountPanelVisible;
    const panel = document.getElementById('accountPanel');
    panel.style.display = accountPanelVisible ? 'block' : 'none';
    
    if (accountPanelVisible) {
        updateAccountInfo();
    }
}

function hideAccountPanel() {
    accountPanelVisible = false;
    document.getElementById('accountPanel').style.display = 'none';
}

function showDeleteConfirm() {
    document.getElementById('deleteConfirm').style.display = 'block';
    hideAccountPanel();
}

function hideDeleteConfirm() {
    document.getElementById('deleteConfirm').style.display = 'none';
}

function logout() {
    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞?\n–í—Å–µ –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã.')) {
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–µ—Ä–µ–¥ –≤—ã—Ö–æ–¥–æ–º
        saveGameData();
        
        // –°–±—Ä–æ—Å —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏
        currentGame = null;
        hideAllPanels();
        hideAccountPanel();
        stop3DScene();
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–µ–Ω—é –∏–≥—Ä
        document.getElementById('gamesMenu').style.display = 'grid';
        
        showNotification('–í—ã –≤—ã—à–ª–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞. –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã.');
    }
}

function deleteAccount() {
    hideDeleteConfirm();
    
    // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è
    const confirmText = prompt('–î–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞ –≤–≤–µ–¥–∏—Ç–µ —Å–ª–æ–≤–æ "–£–î–ê–õ–ò–¢–¨":');
    
    if (confirmText !== '–£–î–ê–õ–ò–¢–¨') {
        showNotification('–£–¥–∞–ª–µ–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ. –ù–µ–≤–µ—Ä–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ.', 'error');
        return;
    }
    
    // –£–¥–∞–ª—è–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–≥—Ä—ã
    localStorage.removeItem('stels_save');
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º gameData –∫ –Ω–∞—á–∞–ª—å–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏—è–º
    gameData = {
        coins: 1000,
        level: 1,
        items: [],
        playerRole: 0,
        playerName: "–ò–≥—Ä–æ–∫",
        stats: {
            gamesPlayed: 0,
            totalCoinsEarned: 0,
            itemsBought: 0,
            totalPlayTime: 0
        },
        secretsFound: 0,
        lastSecretTime: 0
    };
    
    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–≥—Ä—É
    currentGame = null;
    stop3DScene();
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    showNotification('–ê–∫–∫–∞—É–Ω—Ç —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω! –í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã.', 'error');
    
    // –û–±–Ω–æ–≤–ª—è–µ–º UI
    updateUI();
    updateAccountInfo();
    updateSecretCounter();
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–µ–Ω—é –∏–≥—Ä
    document.getElementById('gamesMenu').style.display = 'grid';
    
    // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –Ω–∞—á–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    setTimeout(() => {
        saveGameData();
    }, 1000);
}

function showStats() {
    hideAccountPanel();
    
    // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤—Ä–µ–º—è –∏–≥—Ä—ã
    const totalSeconds = Math.floor(gameData.stats.totalPlayTime / 1000);
    const hours = Math.floor(totalSeconds / 3600);
    const minutes = Math.floor((totalSeconds % 3600) / 60);
    const seconds = totalSeconds % 60;
    
    // –°–µ–∫—Ä–µ—Ç–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
    let secretAchievements = '';
    if (gameData.secretsFound >= 1) {
        secretAchievements += 'üîì –ù–∞—à–µ–ª —Å–µ–∫—Ä–µ—Ç\n';
    }
    if (gameData.secretsFound >= 3) {
        secretAchievements += 'üîì –û—Ö–æ—Ç–Ω–∏–∫ –∑–∞ —Å–µ–∫—Ä–µ—Ç–∞–º–∏\n';
    }
    if (gameData.secretsFound >= 5) {
        secretAchievements += 'üîì –ú–∞—Å—Ç–µ—Ä —Å–µ–∫—Ä–µ—Ç–æ–≤\n';
    }
    
    alert(`üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä–æ–∫–∞:\n\n` +
          `üë§ –ò–º—è: ${gameData.playerName}\n` +
          `üìà –£—Ä–æ–≤–µ–Ω—å: ${gameData.level}\n` +
          `üí∞ –ë–∞–ª–∞–Ω—Å: ${gameData.coins} –º–æ–Ω–µ—Ç\n` +
          `üéÆ –ò–≥—Ä —Å—ã–≥—Ä–∞–Ω–æ: ${gameData.stats.gamesPlayed}\n` +
          `üí∏ –í—Å–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: ${gameData.stats.totalCoinsEarned} –º–æ–Ω–µ—Ç\n` +
          `üõí –ü—Ä–µ–¥–º–µ—Ç–æ–≤ –∫—É–ø–ª–µ–Ω–æ: ${gameData.stats.itemsBought}\n` +
          `‚è∞ –í—Ä–µ–º—è –≤ –∏–≥—Ä–µ: ${hours}—á ${minutes}–º ${seconds}—Å\n` +
          `üéØ –†–æ–ª—å: ${['–ò–≥—Ä–æ–∫', '–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä', '–ê–¥–º–∏–Ω', '–ì–ª–∞–≤–Ω—ã–π –∞–¥–º–∏–Ω'][gameData.playerRole]}\n` +
          `üîç –ù–∞–π–¥–µ–Ω–æ —Å–µ–∫—Ä–µ—Ç–æ–≤: ${gameData.secretsFound}\n\n` +
          `üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è:\n${secretAchievements || '–ü–æ–∫–∞ –Ω–µ—Ç –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π'}`);
}

// üë• –°–∏—Å—Ç–µ–º–∞ –∏–≥—Ä–æ–∫–æ–≤ –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è
function createTestPlayers() {
    players = [
        { id: 1, name: "–ò–≥—Ä–æ–∫_1", role: 0, x: -2, y: 0, z: 0, color: 0x3b82f6 },
        { id: 2, name: "–ò–≥—Ä–æ–∫_2", role: 0, x: 2, y: 0, z: 0, color: 0x3b82f6 },
        { id: 3, name: "–ú–æ–¥–µ—Ä", role: 1, x: 0, y: 0, z: -2, color: 0x10b981 },
        { id: 4, name: "–ê–¥–º–∏–Ω", role: 2, x: -3, y: 0, z: 2, color: 0xf59e0b },
        { id: 5, name: "–ì–ª–∞–≤–Ω—ã–π", role: 3, x: 3, y: 0, z: -3, color: 0xef4444 }
    ];
}

function updatePlayerList() {
    const playerList = document.getElementById('playerList');
    playerList.innerHTML = players.map(player => {
        const roleNames = ['üë§ –ò–≥—Ä–æ–∫', 'üõ°Ô∏è –ú–æ–¥–µ—Ä', '‚ö° –ê–¥–º–∏–Ω', 'üëë –ì–ª–∞–≤–Ω—ã–π'];
        const coords = gameData.playerRole >= 2 ? ` (${player.x}, ${player.z})` : '';
        return `
            <div class="player-item">
                <div>${player.name}</div>
                <div class="player-role">
                    ${roleNames[player.role]}${coords}
                </div>
            </div>
        `;
    }).join('');
}

function toggleAdminPanel() {
    adminPanelVisible = !adminPanelVisible;
    const panel = document.getElementById('adminPanel');
    panel.style.display = adminPanelVisible ? 'block' : 'none';
    
    if (adminPanelVisible) {
        updatePlayerList();
        if (currentGame && gameData.playerRole > 0) {
            showHitboxes();
        }
    } else {
        hideHitboxes();
    }
}

function showHitboxes() {
    if (!scene || !camera) return;
    
    // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ —Ö–∏—Ç–±–æ–∫—Å—ã
    hideHitboxes();
    
    players.forEach(player => {
        if (player.id === 1) return; // –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ö–∏—Ç–±–æ–∫—Å –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
        
        const geometry = new THREE.BoxGeometry(1, 1, 1);
        let material;
        
        if (gameData.playerRole >= 3) {
            // –ì–ª–∞–≤–Ω—ã–π –∞–¥–º–∏–Ω: –∫—Ä–∞—Å–Ω—ã–µ –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–µ —Å–∫–≤–æ–∑—å —Å—Ç–µ–Ω—ã
            material = new THREE.MeshBasicMaterial({ 
                color: 0xff0000, 
                wireframe: true,
                transparent: true,
                opacity: 0.3,
                depthTest: false,
                depthWrite: false
            });
        } else if (gameData.playerRole >= 2) {
            // –ê–¥–º–∏–Ω: –æ—Ä–∞–Ω–∂–µ–≤—ã–µ –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–µ —Å–∫–≤–æ–∑—å —Å—Ç–µ–Ω—ã
            material = new THREE.MeshBasicMaterial({ 
                color: 0xff9900, 
                wireframe: true,
                transparent: true,
                opacity: 0.4,
                depthTest: false,
                depthWrite: false
            });
        } else if (gameData.playerRole >= 1) {
            // –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä: —Å–∏–Ω–∏–µ –Ω–µ–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–µ
            material = new THREE.MeshBasicMaterial({ 
                color: 0x0099ff, 
                wireframe: true,
                transparent: false
            });
        } else {
            return; // –ò–≥—Ä–æ–∫–∏ –Ω–µ –≤–∏–¥—è—Ç —Ö–∏—Ç–±–æ–∫—Å—ã
        }
        
        const hitbox = new THREE.Mesh(geometry, material);
        hitbox.position.set(player.x, player.y, player.z);
        
        scene.add(hitbox);
        hitboxes.push(hitbox);
    });
}

function hideHitboxes() {
    hitboxes.forEach(hitbox => {
        if (hitbox && scene) {
            scene.remove(hitbox);
            if (hitbox.geometry) {
                hitbox.geometry.dispose();
            }
            if (hitbox.material) {
                hitbox.material.dispose();
            }
        }
    });
    hitboxes = [];
}

// üéÆ –ò–≥—Ä—ã
function showGames() {
    document.getElementById('gamesMenu').style.display = 'grid';
    hideAllPanels();
    stop3DScene();
}

function hideGames() {
    document.getElementById('gamesMenu').style.display = 'none';
}

function startGame(gameType) {
    if (isMobileDevice) return;
    
    currentGame = gameType;
    hideGames();
    hideAllPanels();
    hideHitboxes();
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º canvas –∏ –∑–∞–ø—É—Å–∫–∞–µ–º 3D —Å—Ü–µ–Ω—É
    document.getElementById('gameCanvas').style.display = 'block';
    init3DScene(gameType);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    gameData.coins += 10;
    gameData.stats.gamesPlayed += 1;
    gameData.stats.totalCoinsEarned += 10;
    
    saveGameData();
    updateUI();
    
    showNotification('–ò–≥—Ä–∞ "' + getGameName(gameType) + '" –Ω–∞—á–∞–ª–∞—Å—å! –ù–∞–∂–º–∏—Ç–µ TAB –¥–ª—è —Å–ø–∏—Å–∫–∞ –∏–≥—Ä–æ–∫–æ–≤');
}

function getGameName(type) {
    const names = {
        '99nights': '99 –ù–æ—á–µ–π',
        'parkour': '–ü–∞—Ä–∫—É—Ä',
        'battle': '–ë–∏—Ç–≤–∞',
        'build': '–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ'
    };
    return names[type] || '–ò–≥—Ä–∞';
}

function stop3DScene() {
    if (animationId) {
        cancelAnimationFrame(animationId);
        animationId = null;
    }
    if (renderer) {
        renderer.dispose();
        renderer = null;
    }
    if (scene) {
        while(scene.children.length > 0) { 
            const child = scene.children[0];
            if (child.geometry) child.geometry.dispose();
            if (child.material) {
                if (Array.isArray(child.material)) {
                    child.material.forEach(m => m.dispose());
                } else {
                    child.material.dispose();
                }
            }
            scene.remove(child);
        }
    }
    scene = null;
    camera = null;
    cube = null;
    hideHitboxes();
    document.getElementById('gameCanvas').style.display = 'none';
}

function init3DScene(gameType) {
    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å—Ü–µ–Ω—É
    stop3DScene();
    
    // –°–æ–∑–¥–∞–µ–º —Å—Ü–µ–Ω—É
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x0f172a);
    scene.fog = new THREE.Fog(0x0f172a, 5, 20);
    
    // –ö–∞–º–µ—Ä–∞
    camera = new THREE.PerspectiveCamera(
        75, 
        window.innerWidth / window.innerHeight, 
        0.1, 
        1000
    );
    camera.position.z = 5;
    camera.position.y = 2;
    
    // –†–µ–Ω–¥–µ—Ä–µ—Ä
    const canvas = document.getElementById('gameCanvas');
    renderer = new THREE.WebGLRenderer({ 
        canvas, 
        antialias: true,
        alpha: false,
        powerPreference: "high-performance"
    });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    renderer.shadowMap.enabled = true;
    renderer.shadowMap.type = THREE.PCFSoftShadowMap;
    
    // –û—Å–≤–µ—â–µ–Ω–∏–µ
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
    scene.add(ambientLight);
    
    const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
    directionalLight.position.set(10, 20, 15);
    directionalLight.castShadow = true;
    directionalLight.shadow.camera.left = -20;
    directionalLight.shadow.camera.right = 20;
    directionalLight.shadow.camera.top = 20;
    directionalLight.shadow.camera.bottom = -20;
    directionalLight.shadow.mapSize.width = 2048;
    directionalLight.shadow.mapSize.height = 2048;
    scene.add(directionalLight);
    
    // –ü–æ–ª
    const floorGeometry = new THREE.PlaneGeometry(20, 20);
    const floorMaterial = new THREE.MeshStandardMaterial({ 
        color: 0x1e293b,
        roughness: 0.8,
        metalness: 0.2
    });
    const floor = new THREE.Mesh(floorGeometry, floorMaterial);
    floor.rotation.x = -Math.PI / 2;
    floor.receiveShadow = true;
    scene.add(floor);
    
    // –û–±—ä–µ–∫—Ç—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∏–≥—Ä—ã
    if (gameType === '99nights') {
        // –ó–æ–º–±–∏
        const geometry = new THREE.BoxGeometry(1, 2, 1);
        const material = new THREE.MeshStandardMaterial({ 
            color: 0x00ff00,
            roughness: 0.7,
            metalness: 0.3
        });
        cube = new THREE.Mesh(geometry, material);
        cube.castShadow = true;
        cube.position.y = 1;
        scene.add(cube);
        
        // –°—Ç–µ–Ω—ã
        const wallGeometry = new THREE.BoxGeometry(8, 4, 0.5);
        const wallMaterial = new THREE.MeshStandardMaterial({ 
            color: 0x475569,
            roughness: 0.6,
            metalness: 0.1
        });
        const wall = new THREE.Mesh(wallGeometry, wallMaterial);
        wall.position.set(0, 2, -5);
        wall.castShadow = true;
        wall.receiveShadow = true;
        scene.add(wall);
        
        // –¢–µ—Å—Ç–æ–≤—ã–µ –∏–≥—Ä–æ–∫–∏ –≤ —Å—Ü–µ–Ω–µ
        players.forEach(player => {
            if (player.id === 1) return;
            
            const playerGeometry = new THREE.BoxGeometry(0.8, 1.8, 0.8);
            const playerMaterial = new THREE.MeshStandardMaterial({ 
                color: player.color,
                roughness: 0.5,
                metalness: 0.2
            });
            const playerMesh = new THREE.Mesh(playerGeometry, playerMaterial);
            playerMesh.position.set(player.x, 0.9, player.z);
            playerMesh.castShadow = true;
            playerMesh.receiveShadow = true;
            scene.add(playerMesh);
        });
        
    } else if (gameType === 'parkour') {
        // –ü–ª–∞—Ç—Ñ–æ—Ä–º—ã
        const geometry = new THREE.BoxGeometry(3, 0.5, 3);
        const material = new THREE.MeshStandardMaterial({ 
            color: 0x3b82f6,
            roughness: 0.4,
            metalness: 0.3
        });
        const platform = new THREE.Mesh(geometry, material);
        platform.position.y = -0.25;
        platform.receiveShadow = true;
        scene.add(platform);
        
        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
        for (let i = 0; i < 3; i++) {
            const plat = new THREE.Mesh(geometry, material);
            plat.position.set(Math.random() * 6 - 3, Math.random() * 2, Math.random() * 6 - 3);
            plat.receiveShadow = true;
            scene.add(plat);
        }
    } else if (gameType === 'battle') {
        // –ê—Ä–µ–Ω–∞ –¥–ª—è –±–∏—Ç–≤—ã
        const arenaGeometry = new THREE.CylinderGeometry(5, 5, 0.5, 32);
        const arenaMaterial = new THREE.MeshStandardMaterial({ 
            color: 0xef4444,
            roughness: 0.6,
            metalness: 0.2
        });
        const arena = new THREE.Mesh(arenaGeometry, arenaMaterial);
        arena.receiveShadow = true;
        scene.add(arena);
        
        // –ò–≥—Ä–æ–∫–∏ –Ω–∞ –∞—Ä–µ–Ω–µ
        const playerGeometry = new THREE.ConeGeometry(0.5, 1.5, 8);
        players.forEach((player, index) => {
            const playerMaterial = new THREE.MeshStandardMaterial({ 
                color: player.color,
                roughness: 0.4,
                metalness: 0.3
            });
            const playerMesh = new THREE.Mesh(playerGeometry, playerMaterial);
            const angle = (index / players.length) * Math.PI * 2;
            playerMesh.position.set(Math.cos(angle) * 3, 0.75, Math.sin(angle) * 3);
            playerMesh.rotation.x = Math.PI / 2;
            playerMesh.castShadow = true;
            scene.add(playerMesh);
        });
    } else if (gameType === 'build') {
        // –°—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–µ –±–ª–æ–∫–∏
        const blockGeometry = new THREE.BoxGeometry(1, 1, 1);
        const colors = [0x3b82f6, 0x10b981, 0xf59e0b, 0xef4444, 0x8b5cf6];
        
        // –°–æ–∑–¥–∞–µ–º —Å–µ—Ç–∫—É –±–ª–æ–∫–æ–≤
        for (let x = -2; x <= 2; x++) {
            for (let z = -2; z <= 2; z++) {
                const colorIndex = (x + 2) + (z + 2) * 5;
                const blockMaterial = new THREE.MeshStandardMaterial({ 
                    color: colors[colorIndex % colors.length],
                    roughness: 0.5,
                    metalness: 0.2
                });
                const block = new THREE.Mesh(blockGeometry, blockMaterial);
                block.position.set(x * 1.2, 0.5, z * 1.2);
                block.castShadow = true;
                block.receiveShadow = true;
                scene.add(block);
            }
        }
    }
    
    // –ê–Ω–∏–º–∞—Ü–∏—è —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –≤—Ä–µ–º–µ–Ω–Ω—ã–º —à–∞–≥–æ–º –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏
    let lastTime = 0;
    function animate(currentTime) {
        animationId = requestAnimationFrame(animate);
        
        // –í—ã—á–∏—Å–ª—è–µ–º deltaTime –¥–ª—è –ø–ª–∞–≤–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–∏
        const deltaTime = (currentTime - lastTime) / 1000;
        lastTime = currentTime;
        
        // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º deltaTime —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —Ä—ã–≤–∫–æ–≤
        const fixedDeltaTime = Math.min(deltaTime, 0.1);
        
        if (cube) {
            cube.rotation.y += fixedDeltaTime * 2;
            cube.position.y = 1 + Math.sin(currentTime * 0.002) * 0.2;
        }
        
        // –ú—è–≥–∫–æ–µ –≤—Ä–∞—â–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º deltaTime
        if (camera && currentGame !== 'battle') {
            const time = currentTime * 0.0005;
            camera.position.x = Math.sin(time) * 3;
            camera.position.z = 5 + Math.cos(time) * 1;
            camera.lookAt(0, 0, 0);
        }
        
        renderer.render(scene, camera);
    }
    
    animate(0);
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
    function onWindowResize() {
        if (camera && renderer) {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
    }
    
    window.addEventListener('resize', onWindowResize, false);
}

// üõí –ú–∞–≥–∞–∑–∏–Ω
function showPanel(panelId) {
    if (isMobileDevice) return;
    
    hideGames();
    hideAllPanels();
    stop3DScene();
    
    const panel = document.getElementById(panelId);
    if (panel) {
        panel.style.display = 'block';
        
        if (panelId === 'shopPanel') {
            loadShopItems();
        }
    }
}

function hidePanel(panelId) {
    const panel = document.getElementById(panelId);
    if (panel) {
        panel.style.display = 'none';
    }
}

function hideAllPanels() {
    document.querySelectorAll('.panel').forEach(panel => {
        panel.style.display = 'none';
    });
    document.getElementById('adminPanel').style.display = 'none';
    document.getElementById('accountPanel').style.display = 'none';
    adminPanelVisible = false;
    accountPanelVisible = false;
    hideHitboxes();
}

function loadShopItems() {
    const items = [
        { id: 1, name: '–ó–æ–ª–æ—Ç–∞—è –∫–æ—Ä–æ–Ω–∞', price: 500, icon: 'üëë' },
        { id: 2, name: '–ö—Ä—ã–ª—å—è –∞–Ω–≥–µ–ª–∞', price: 300, icon: 'üëº' },
        { id: 3, name: '–õ–∞–∑–µ—Ä–Ω—ã–π –º–µ—á', price: 250, icon: '‚öîÔ∏è' },
        { id: 4, name: '–†—é–∫–∑–∞–∫', price: 150, icon: 'üéí' },
        { id: 5, name: '–û—á–∫–∏ VR', price: 400, icon: 'ü•Ω' },
        { id: 6, name: '–°–∫–µ–π—Ç–±–æ—Ä–¥', price: 350, icon: 'üõπ' }
    ];
    
    const container = document.getElementById('shopItems');
    container.innerHTML = items.map(item => `
        <div class="shop-item" onclick="buyItem(${item.id}, ${item.price})">
            <div style="font-size: 2rem;">${item.icon}</div>
            <div style="margin: 10px 0; font-weight: bold;">${item.name}</div>
            <div style="color: #fbbf24;">${item.price} üí∞</div>
        </div>
    `).join('');
}

function buyItem(itemId, price) {
    if (gameData.coins >= price) {
        gameData.coins -= price;
        gameData.items.push(itemId);
        gameData.stats.itemsBought += 1;
        updateUI();
        saveGameData();
        showNotification('–ö—É–ø–ª–µ–Ω–æ! –û—Å—Ç–∞–ª–æ—Å—å: ' + gameData.coins + ' üí∞');
    } else {
        showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!', 'error');
    }
}

function equipItem(slot) {
    showNotification('–ù–∞–¥–µ—Ç–æ: ' + slot);
}

// üí¨ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
function showNotification(message, type = 'success') {
    const notification = document.getElementById('notification');
    notification.textContent = message;
    notification.style.display = 'block';
    notification.style.background = type === 'error' 
        ? 'rgba(239, 68, 68, 0.9)' 
        : 'rgba(21, 128, 61, 0.9)';
    
    setTimeout(() => {
        notification.style.display = 'none';
    }, 3000);
}

// üéØ –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
window.addEventListener('keydown', (e) => {
    if (isMobileDevice) return;
    
    if (e.key === 'Escape') {
        e.preventDefault();
        if (currentGame) {
            currentGame = null;
            showGames();
            stop3DScene();
        } else {
            hideAllPanels();
            hideGames();
        }
    }
    
    if (e.key === 'Tab') {
        e.preventDefault();
        if (currentGame) {
            toggleAdminPanel();
        }
    }
    
    // –°–µ–∫—Ä–µ—Ç–Ω–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è –∫–ª–∞–≤–∏—à: CTRL + SHIFT + S
    if (e.ctrlKey && e.shiftKey && e.key === 'S') {
        e.preventDefault();
        gameData.coins += 1000;
        updateUI();
        saveGameData();
        showNotification('üéÅ –°–µ–∫—Ä–µ—Ç–Ω–∞—è –Ω–∞–≥—Ä–∞–¥–∞: +1000 –º–æ–Ω–µ—Ç!');
    }
});

window.addEventListener('keyup', (e) => {
    if (e.key === 'Tab') {
        isTabPressed = false;
    }
});

// –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é
window.addEventListener('contextmenu', (e) => {
    if (currentGame) {
        e.preventDefault();
    }
});

// –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
window.addEventListener('DOMContentLoaded', init);

// –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
setInterval(() => {
    if (!isMobileDevice) {
        saveGameData();
    }
}, 30000);

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
window.addEventListener('resize', function() {
    if (camera && renderer) {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    }
});

// –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö (–µ—Å–ª–∏ –≤—Å—ë –∂–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å)
document.addEventListener('touchmove', function(e) {
    if (e.scale !== 1) {
        e.preventDefault();
    }
}, { passive: false });

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
window.addEventListener('beforeunload', function(e) {
    saveGameData();
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</body>
</html>
